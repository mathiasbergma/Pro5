\hypertarget{_n_b___r410_m_8h_source}{}\doxysection{NB\+\_\+\+R410\+M.\+h}
\label{_n_b___r410_m_8h_source}\index{src/NB\_R410M.h@{src/NB\_R410M.h}}
\mbox{\hyperlink{_n_b___r410_m_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 }
\DoxyCodeLine{25 \textcolor{preprocessor}{\#include <Arduino.h>}}
\DoxyCodeLine{26 \textcolor{preprocessor}{\#include "{}AT\_commands.h"{}}}
\DoxyCodeLine{27 \textcolor{preprocessor}{\#include <HardwareSerial.h>}}
\DoxyCodeLine{28 }
\DoxyCodeLine{29 HardwareSerial lteSerial(2);}
\DoxyCodeLine{30 }
\DoxyCodeLine{31 \textcolor{preprocessor}{\#define SerialMonitor Serial}}
\DoxyCodeLine{32 \textcolor{preprocessor}{\#define LTEShieldSerial lteSerial}}
\DoxyCodeLine{33 }
\DoxyCodeLine{38 \textcolor{keywordtype}{void} \mbox{\hyperlink{_n_b___r410_m_8h_a301d0294e9c5137ccbc922d3bf7831aa}{transmitCommand}}(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *command)}
\DoxyCodeLine{39 \{}
\DoxyCodeLine{40   \textcolor{comment}{// SerialMonitor.printf("{}Command: \%s\(\backslash\)n"{}, command);}}
\DoxyCodeLine{41   \textcolor{comment}{//  Empty the serial buffer}}
\DoxyCodeLine{42   \textcolor{keywordflow}{while} (LTEShieldSerial.available())}
\DoxyCodeLine{43   \{}
\DoxyCodeLine{44     LTEShieldSerial.read();}
\DoxyCodeLine{45   \}}
\DoxyCodeLine{46   \textcolor{comment}{// Transmit the command}}
\DoxyCodeLine{47   LTEShieldSerial.print(command);}
\DoxyCodeLine{48   LTEShieldSerial.print(\textcolor{stringliteral}{"{}\(\backslash\)r"{}});}
\DoxyCodeLine{49 \}}
\DoxyCodeLine{50 }
\DoxyCodeLine{56 \textcolor{keywordtype}{int} \mbox{\hyperlink{_n_b___r410_m_8h_a2540498d294eca76534a8015310df26d}{getResponse}}(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *response, \textcolor{keywordtype}{int} timeout)}
\DoxyCodeLine{57 \{}
\DoxyCodeLine{58   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} timeIn = millis();}
\DoxyCodeLine{59   \textcolor{keywordtype}{char} ret[128];}
\DoxyCodeLine{60   \textcolor{keywordtype}{int} destIndex = 0;}
\DoxyCodeLine{61   \textcolor{keywordtype}{int} index = 0;}
\DoxyCodeLine{62   \textcolor{keywordtype}{char} c;}
\DoxyCodeLine{63   \textcolor{keywordtype}{int} size = strlen(response);}
\DoxyCodeLine{64 }
\DoxyCodeLine{65   \textcolor{keywordflow}{while} (millis() -\/ timeIn < timeout)}
\DoxyCodeLine{66   \{}
\DoxyCodeLine{67     \textcolor{keywordflow}{if} (LTEShieldSerial.available())}
\DoxyCodeLine{68     \{}
\DoxyCodeLine{69       c = (char)LTEShieldSerial.read();}
\DoxyCodeLine{70       \textcolor{comment}{//Serial.print(c);}}
\DoxyCodeLine{71       ret[destIndex++] = c;}
\DoxyCodeLine{72 }
\DoxyCodeLine{73       \textcolor{keywordflow}{if} (c == response[index])}
\DoxyCodeLine{74       \{}
\DoxyCodeLine{75         index++;}
\DoxyCodeLine{76         \textcolor{keywordflow}{if} (index == size)}
\DoxyCodeLine{77         \{}
\DoxyCodeLine{78           \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{79         \}}
\DoxyCodeLine{80       \}}
\DoxyCodeLine{81       \textcolor{keywordflow}{else}}
\DoxyCodeLine{82       \{}
\DoxyCodeLine{83         index = 0;}
\DoxyCodeLine{84       \}}
\DoxyCodeLine{85     \}}
\DoxyCodeLine{86   \}}
\DoxyCodeLine{87   ret[destIndex] = \textcolor{charliteral}{'\(\backslash\)0'};}
\DoxyCodeLine{88   \textcolor{comment}{//Serial.println(ret);}}
\DoxyCodeLine{89   \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{90 \}}
\DoxyCodeLine{91 }
\DoxyCodeLine{97 \textcolor{keywordtype}{int} \mbox{\hyperlink{_n_b___r410_m_8h_a66f862d5c7d16623b90ccf294c1cf055}{initModule}}(\textcolor{keywordtype}{int} timeout)}
\DoxyCodeLine{98 \{}
\DoxyCodeLine{99   LTEShieldSerial.begin(9600);}
\DoxyCodeLine{100   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} startTime = millis();}
\DoxyCodeLine{101   SerialMonitor.printf(\textcolor{stringliteral}{"{}Transmitting AT\(\backslash\)n"{}});}
\DoxyCodeLine{102   \textcolor{keywordflow}{while} (!\mbox{\hyperlink{_n_b___r410_m_8h_a2540498d294eca76534a8015310df26d}{getResponse}}(\textcolor{stringliteral}{"{}OK"{}}, 500))}
\DoxyCodeLine{103   \{}
\DoxyCodeLine{104     SerialMonitor.printf(\textcolor{stringliteral}{"{}."{}});}
\DoxyCodeLine{105     \mbox{\hyperlink{_n_b___r410_m_8h_a301d0294e9c5137ccbc922d3bf7831aa}{transmitCommand}}(\textcolor{stringliteral}{"{}AT"{}}); \textcolor{comment}{// Send AT command to enable the interface}}
\DoxyCodeLine{106     }
\DoxyCodeLine{107     \textcolor{keywordflow}{if} (millis() -\/ startTime > timeout)}
\DoxyCodeLine{108     \{}
\DoxyCodeLine{109       \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{110     \}}
\DoxyCodeLine{111   \}}
\DoxyCodeLine{112   SerialMonitor.printf(\textcolor{stringliteral}{"{}Got OK\(\backslash\)n"{}});}
\DoxyCodeLine{113 }
\DoxyCodeLine{114   SerialMonitor.printf(\textcolor{stringliteral}{"{}Disabling echo\(\backslash\)n"{}});}
\DoxyCodeLine{115   \mbox{\hyperlink{_n_b___r410_m_8h_a301d0294e9c5137ccbc922d3bf7831aa}{transmitCommand}}(\textcolor{stringliteral}{"{}ATE0"{}}); \textcolor{comment}{// Disable echo}}
\DoxyCodeLine{116   \textcolor{keywordflow}{if} (\mbox{\hyperlink{_n_b___r410_m_8h_a2540498d294eca76534a8015310df26d}{getResponse}}(\textcolor{stringliteral}{"{}OK"{}}, 200))}
\DoxyCodeLine{117   \{}
\DoxyCodeLine{118     SerialMonitor.println(\textcolor{stringliteral}{"{}Echo disabled"{}});}
\DoxyCodeLine{119   \}}
\DoxyCodeLine{120   \textcolor{keywordflow}{else}}
\DoxyCodeLine{121   \{}
\DoxyCodeLine{122     SerialMonitor.println(\textcolor{stringliteral}{"{}Echo not disabled"{}});}
\DoxyCodeLine{123   \}}
\DoxyCodeLine{124 }
\DoxyCodeLine{125   \mbox{\hyperlink{_n_b___r410_m_8h_a301d0294e9c5137ccbc922d3bf7831aa}{transmitCommand}}(\textcolor{stringliteral}{"{}AT+CTZU=1"{}}); \textcolor{comment}{// Enable automatic time zone update}}
\DoxyCodeLine{126   \textcolor{keywordflow}{if} (\mbox{\hyperlink{_n_b___r410_m_8h_a2540498d294eca76534a8015310df26d}{getResponse}}(\textcolor{stringliteral}{"{}OK"{}}, 5000))}
\DoxyCodeLine{127   \{}
\DoxyCodeLine{128     SerialMonitor.println(\textcolor{stringliteral}{"{}Automatic time zone update enabled"{}});}
\DoxyCodeLine{129   \}}
\DoxyCodeLine{130   \textcolor{keywordflow}{else}}
\DoxyCodeLine{131   \{}
\DoxyCodeLine{132     SerialMonitor.println(\textcolor{stringliteral}{"{}Automatic time zone update not enabled"{}});}
\DoxyCodeLine{133   \}}
\DoxyCodeLine{134   \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{135 \}}
\DoxyCodeLine{141 \textcolor{keywordtype}{int} \mbox{\hyperlink{_n_b___r410_m_8h_a45ea19fd14a7f7c3d7803940c809dec8}{enableSSL}}(\textcolor{keywordtype}{int} profile)}
\DoxyCodeLine{142 \{}
\DoxyCodeLine{143   \textcolor{keywordtype}{char} *command = NULL;}
\DoxyCodeLine{144   command = (\textcolor{keywordtype}{char} *)malloc(strlen(AT) + strlen(SARA\_MQTT\_SECURE) + 5);}
\DoxyCodeLine{145   \textcolor{keywordflow}{if} (command == NULL)}
\DoxyCodeLine{146   \{}
\DoxyCodeLine{147     SerialMonitor.println(\textcolor{stringliteral}{"{}Malloc failed"{}});}
\DoxyCodeLine{148     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{149   \}}
\DoxyCodeLine{150 }
\DoxyCodeLine{151   sprintf(command, \textcolor{stringliteral}{"{}\%s\%s\%d"{}}, AT, SARA\_MQTT\_SECURE, profile);}
\DoxyCodeLine{152   \mbox{\hyperlink{_n_b___r410_m_8h_a301d0294e9c5137ccbc922d3bf7831aa}{transmitCommand}}(command);}
\DoxyCodeLine{153   \textcolor{keywordflow}{if} (\mbox{\hyperlink{_n_b___r410_m_8h_a2540498d294eca76534a8015310df26d}{getResponse}}(SARA\_MQTT\_SECURE\_SET\_RESPONSE, 5000))}
\DoxyCodeLine{154   \{}
\DoxyCodeLine{155     SerialMonitor.println(\textcolor{stringliteral}{"{}SSL enabled"{}});}
\DoxyCodeLine{156     \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{157   \}}
\DoxyCodeLine{158   \textcolor{keywordflow}{else}}
\DoxyCodeLine{159   \{}
\DoxyCodeLine{160     SerialMonitor.println(\textcolor{stringliteral}{"{}SSL not enabled"{}});}
\DoxyCodeLine{161     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{162   \}}
\DoxyCodeLine{163 \}}
\DoxyCodeLine{164 }
\DoxyCodeLine{168 \textcolor{keywordtype}{void} \mbox{\hyperlink{_n_b___r410_m_8h_aa6f75e9b70b0ada28fb438225a155bbb}{getNetwork}}()}
\DoxyCodeLine{169 \{}
\DoxyCodeLine{170   \textcolor{keywordtype}{int} retval;}
\DoxyCodeLine{171   \textcolor{keywordtype}{int} last = 99;}
\DoxyCodeLine{172   \textcolor{keywordflow}{while} (retval != 1)}
\DoxyCodeLine{173   \{}
\DoxyCodeLine{174 }
\DoxyCodeLine{175     \textcolor{comment}{// Empty the serial buffer}}
\DoxyCodeLine{176     \textcolor{keywordflow}{while} (LTEShieldSerial.available())}
\DoxyCodeLine{177     \{}
\DoxyCodeLine{178       LTEShieldSerial.read();}
\DoxyCodeLine{179     \}}
\DoxyCodeLine{180     \mbox{\hyperlink{_n_b___r410_m_8h_a301d0294e9c5137ccbc922d3bf7831aa}{transmitCommand}}(\textcolor{stringliteral}{"{}AT+CEREG?"{}});}
\DoxyCodeLine{181     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} timeIn = millis();}
\DoxyCodeLine{182     \textcolor{keywordtype}{char} ret[128];}
\DoxyCodeLine{183     \textcolor{keywordtype}{int} destIndex = 0;}
\DoxyCodeLine{184     \textcolor{keywordtype}{int} index = 0;}
\DoxyCodeLine{185     \textcolor{keywordtype}{char} c;}
\DoxyCodeLine{186     \textcolor{keywordtype}{int} size = 12;}
\DoxyCodeLine{187     retval = 4;}
\DoxyCodeLine{188 }
\DoxyCodeLine{189     \textcolor{keywordflow}{while} (millis() -\/ timeIn < 1000)}
\DoxyCodeLine{190     \{}
\DoxyCodeLine{191       \textcolor{keywordflow}{if} (LTEShieldSerial.available())}
\DoxyCodeLine{192       \{}
\DoxyCodeLine{193         c = (char)LTEShieldSerial.read();}
\DoxyCodeLine{194         \textcolor{comment}{// Serial.print(c);}}
\DoxyCodeLine{195         ret[index++] = c;}
\DoxyCodeLine{196         \textcolor{comment}{// SerialMonitor.printf("{}index: \%d\(\backslash\)n"{}, index);}}
\DoxyCodeLine{197         \textcolor{keywordflow}{if} (index > size)}
\DoxyCodeLine{198         \{}
\DoxyCodeLine{199           \textcolor{keywordflow}{break};}
\DoxyCodeLine{200         \}}
\DoxyCodeLine{201       \}}
\DoxyCodeLine{202     \}}
\DoxyCodeLine{203     ret[++index] = 0;}
\DoxyCodeLine{204     \textcolor{comment}{// SerialMonitor.printf("{}ret: \%s\(\backslash\)n"{}, ret);}}
\DoxyCodeLine{205     sscanf(ret, \textcolor{stringliteral}{"{} +CEREG: 0,\%d"{}}, \&retval);}
\DoxyCodeLine{206     \textcolor{keywordflow}{switch} (retval)}
\DoxyCodeLine{207     \{}
\DoxyCodeLine{208     \textcolor{keywordflow}{case} 0:}
\DoxyCodeLine{209       \textcolor{keywordflow}{if} (last != retval)}
\DoxyCodeLine{210       \{}
\DoxyCodeLine{211         SerialMonitor.printf(\textcolor{stringliteral}{"{}Not registered, MT is not currently searching a new operator to register to\(\backslash\)n"{}});}
\DoxyCodeLine{212         last = retval;}
\DoxyCodeLine{213       \}}
\DoxyCodeLine{214       \textcolor{keywordflow}{else}}
\DoxyCodeLine{215       \{}
\DoxyCodeLine{216         SerialMonitor.printf(\textcolor{stringliteral}{"{}."{}});}
\DoxyCodeLine{217       \}}
\DoxyCodeLine{218       \textcolor{keywordflow}{break};}
\DoxyCodeLine{219     \textcolor{keywordflow}{case} 1:}
\DoxyCodeLine{220       \textcolor{keywordflow}{if} (last != retval)}
\DoxyCodeLine{221       \{}
\DoxyCodeLine{222         SerialMonitor.printf(\textcolor{stringliteral}{"{}Registered, home network\(\backslash\)n"{}});}
\DoxyCodeLine{223         last = retval;}
\DoxyCodeLine{224       \}}
\DoxyCodeLine{225       \textcolor{keywordflow}{else}}
\DoxyCodeLine{226       \{}
\DoxyCodeLine{227         SerialMonitor.printf(\textcolor{stringliteral}{"{}."{}});}
\DoxyCodeLine{228       \}}
\DoxyCodeLine{229       \textcolor{keywordflow}{break};}
\DoxyCodeLine{230     \textcolor{keywordflow}{case} 2:}
\DoxyCodeLine{231       \textcolor{keywordflow}{if} (last != retval)}
\DoxyCodeLine{232       \{}
\DoxyCodeLine{233         SerialMonitor.printf(\textcolor{stringliteral}{"{}Scanning for network\(\backslash\)n"{}});}
\DoxyCodeLine{234         last = retval;}
\DoxyCodeLine{235       \}}
\DoxyCodeLine{236       \textcolor{keywordflow}{else}}
\DoxyCodeLine{237       \{}
\DoxyCodeLine{238         SerialMonitor.printf(\textcolor{stringliteral}{"{}."{}});}
\DoxyCodeLine{239       \}}
\DoxyCodeLine{240       \textcolor{keywordflow}{break};}
\DoxyCodeLine{241     \textcolor{keywordflow}{case} 3:}
\DoxyCodeLine{242       \textcolor{keywordflow}{if} (last != retval)}
\DoxyCodeLine{243       \{}
\DoxyCodeLine{244         SerialMonitor.printf(\textcolor{stringliteral}{"{}Registration denied\(\backslash\)n"{}});}
\DoxyCodeLine{245         last = retval;}
\DoxyCodeLine{246       \}}
\DoxyCodeLine{247       \textcolor{keywordflow}{else}}
\DoxyCodeLine{248       \{}
\DoxyCodeLine{249         SerialMonitor.printf(\textcolor{stringliteral}{"{}."{}});}
\DoxyCodeLine{250       \}}
\DoxyCodeLine{251       \textcolor{keywordflow}{break};}
\DoxyCodeLine{252     \textcolor{keywordflow}{case} 4:}
\DoxyCodeLine{253       \textcolor{keywordflow}{if} (last != retval)}
\DoxyCodeLine{254       \{}
\DoxyCodeLine{255         SerialMonitor.printf(\textcolor{stringliteral}{"{}Unknown\(\backslash\)n"{}});}
\DoxyCodeLine{256         last = retval;}
\DoxyCodeLine{257       \}}
\DoxyCodeLine{258       \textcolor{keywordflow}{else}}
\DoxyCodeLine{259       \{}
\DoxyCodeLine{260         SerialMonitor.printf(\textcolor{stringliteral}{"{}."{}});}
\DoxyCodeLine{261       \}}
\DoxyCodeLine{262       \textcolor{keywordflow}{break};}
\DoxyCodeLine{263     \textcolor{keywordflow}{case} 5:}
\DoxyCodeLine{264       \textcolor{keywordflow}{if} (last != retval)}
\DoxyCodeLine{265       \{}
\DoxyCodeLine{266         SerialMonitor.printf(\textcolor{stringliteral}{"{}Registered, roaming\(\backslash\)n"{}});}
\DoxyCodeLine{267         last = retval;}
\DoxyCodeLine{268       \}}
\DoxyCodeLine{269       \textcolor{keywordflow}{else}}
\DoxyCodeLine{270       \{}
\DoxyCodeLine{271         SerialMonitor.printf(\textcolor{stringliteral}{"{}."{}});}
\DoxyCodeLine{272       \}}
\DoxyCodeLine{273       \textcolor{keywordflow}{break};}
\DoxyCodeLine{274     \textcolor{keywordflow}{default}:}
\DoxyCodeLine{275       \textcolor{keywordflow}{if} (last != retval)}
\DoxyCodeLine{276       \{}
\DoxyCodeLine{277         SerialMonitor.printf(\textcolor{stringliteral}{"{}Unknown\(\backslash\)n"{}});}
\DoxyCodeLine{278         last = retval;}
\DoxyCodeLine{279       \}}
\DoxyCodeLine{280       \textcolor{keywordflow}{else}}
\DoxyCodeLine{281       \{}
\DoxyCodeLine{282         SerialMonitor.printf(\textcolor{stringliteral}{"{}."{}});}
\DoxyCodeLine{283       \}}
\DoxyCodeLine{284       \textcolor{keywordflow}{break};}
\DoxyCodeLine{285     \}}
\DoxyCodeLine{286   \}}
\DoxyCodeLine{287 \}}
\DoxyCodeLine{288 }
\DoxyCodeLine{294 \textcolor{keywordtype}{int} \mbox{\hyperlink{_n_b___r410_m_8h_a155d2d05c4cd7202d2ccec3c482f5e90}{setAPN}}(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *apn)}
\DoxyCodeLine{295 \{}
\DoxyCodeLine{296   \textcolor{keywordtype}{int} result = 0;}
\DoxyCodeLine{297   \textcolor{keywordtype}{char} *command = NULL;}
\DoxyCodeLine{298   command = (\textcolor{keywordtype}{char} *)malloc(strlen(AT) + strlen(LTE\_SHIELD\_SET\_APN) + strlen(apn) + 5);}
\DoxyCodeLine{299   \textcolor{keywordflow}{if} (command == NULL)}
\DoxyCodeLine{300   \{}
\DoxyCodeLine{301     SerialMonitor.println(\textcolor{stringliteral}{"{}Malloc failed"{}});}
\DoxyCodeLine{302     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{303   \}}
\DoxyCodeLine{304 }
\DoxyCodeLine{305   sprintf(command, \textcolor{stringliteral}{"{}\%s\%s\(\backslash\)"{}\%s\(\backslash\)"{}"{}}, AT, LTE\_SHIELD\_SET\_APN, apn);}
\DoxyCodeLine{306   \mbox{\hyperlink{_n_b___r410_m_8h_a301d0294e9c5137ccbc922d3bf7831aa}{transmitCommand}}(command);}
\DoxyCodeLine{307   \textcolor{keywordflow}{if} (\mbox{\hyperlink{_n_b___r410_m_8h_a2540498d294eca76534a8015310df26d}{getResponse}}(\textcolor{stringliteral}{"{}OK"{}}, 1000))}
\DoxyCodeLine{308   \{}
\DoxyCodeLine{309     Serial.println(\textcolor{stringliteral}{"{}APN set"{}});}
\DoxyCodeLine{310     result = 1;}
\DoxyCodeLine{311   \}}
\DoxyCodeLine{312   \textcolor{keywordflow}{else}}
\DoxyCodeLine{313   \{}
\DoxyCodeLine{314     Serial.println(\textcolor{stringliteral}{"{}APN not set"{}});}
\DoxyCodeLine{315   \}}
\DoxyCodeLine{316   free(command);}
\DoxyCodeLine{317   \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{318 \}}
\DoxyCodeLine{319 }
\DoxyCodeLine{324 \textcolor{keywordtype}{char} *\mbox{\hyperlink{_n_b___r410_m_8h_a59fb44183e4857c7b1fa0db81abe59f2}{printInfo}}()}
\DoxyCodeLine{325 \{}
\DoxyCodeLine{326   \textcolor{keywordtype}{char} *ip = NULL;}
\DoxyCodeLine{327   \textcolor{keywordtype}{char} *command = NULL;}
\DoxyCodeLine{328   command = (\textcolor{keywordtype}{char} *)malloc(strlen(AT) + strlen(SARA\_NETWORK\_INFO\_GET) + 5);}
\DoxyCodeLine{329   ip = (\textcolor{keywordtype}{char} *)malloc(16);}
\DoxyCodeLine{330   \textcolor{keywordflow}{if} (ip == NULL)}
\DoxyCodeLine{331   \{}
\DoxyCodeLine{332     SerialMonitor.println(\textcolor{stringliteral}{"{}Malloc failed"{}});}
\DoxyCodeLine{333     \textcolor{keywordflow}{return} NULL;}
\DoxyCodeLine{334   \}}
\DoxyCodeLine{335   \textcolor{keywordflow}{if} (command == NULL)}
\DoxyCodeLine{336   \{}
\DoxyCodeLine{337     SerialMonitor.println(\textcolor{stringliteral}{"{}Malloc failed"{}});}
\DoxyCodeLine{338     \textcolor{keywordflow}{return} NULL;}
\DoxyCodeLine{339   \}}
\DoxyCodeLine{340   sprintf(command, \textcolor{stringliteral}{"{}\%s\%s"{}}, AT, SARA\_NETWORK\_INFO\_GET);}
\DoxyCodeLine{341   \mbox{\hyperlink{_n_b___r410_m_8h_a301d0294e9c5137ccbc922d3bf7831aa}{transmitCommand}}(command);}
\DoxyCodeLine{342 }
\DoxyCodeLine{343   \textcolor{keywordtype}{char} ret[128];}
\DoxyCodeLine{344   \textcolor{keywordtype}{int} destIndex = 0;}
\DoxyCodeLine{345   \textcolor{keywordtype}{int} index = 0;}
\DoxyCodeLine{346   \textcolor{keywordtype}{char} c;}
\DoxyCodeLine{347   \textcolor{keywordtype}{char} OK[] = \textcolor{stringliteral}{"{}OK"{}};}
\DoxyCodeLine{348   \textcolor{keywordtype}{int} size = 12;}
\DoxyCodeLine{349   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} timeIn = millis();}
\DoxyCodeLine{350   \textcolor{keywordflow}{while} (millis() -\/ timeIn < 1000)}
\DoxyCodeLine{351   \{}
\DoxyCodeLine{352     \textcolor{keywordflow}{if} (LTEShieldSerial.available())}
\DoxyCodeLine{353     \{}
\DoxyCodeLine{354       c = (char)LTEShieldSerial.read();}
\DoxyCodeLine{355       \textcolor{comment}{// Serial.print(c);}}
\DoxyCodeLine{356       ret[index] = c;}
\DoxyCodeLine{357       \textcolor{comment}{// SerialMonitor.printf("{}index: \%d\(\backslash\)n"{}, index);}}
\DoxyCodeLine{358       \textcolor{keywordflow}{if} (ret[index -\/ 1] == OK[0] \&\& ret[index] == OK[1])}
\DoxyCodeLine{359       \{}
\DoxyCodeLine{360         \textcolor{keywordflow}{break};}
\DoxyCodeLine{361       \}}
\DoxyCodeLine{362       index++;}
\DoxyCodeLine{363     \}}
\DoxyCodeLine{364   \}}
\DoxyCodeLine{365   \textcolor{comment}{/*}}
\DoxyCodeLine{366 \textcolor{comment}{  +CGDCONT: 1,"{}IP"{},"{}web.omnitel.it"{},"{}91.80.140.199"{},0,0}}
\DoxyCodeLine{367 \textcolor{comment}{  OK}}
\DoxyCodeLine{368 \textcolor{comment}{  */}}
\DoxyCodeLine{369   ret[++index] = 0;}
\DoxyCodeLine{370   \textcolor{keywordtype}{char} * token = strtok(ret, \textcolor{stringliteral}{"{},"{}});}
\DoxyCodeLine{371   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 3; i++)}
\DoxyCodeLine{372   \{}
\DoxyCodeLine{373     token = strtok(NULL, \textcolor{stringliteral}{"{},"{}});}
\DoxyCodeLine{374   \}}
\DoxyCodeLine{375   }
\DoxyCodeLine{376   strcpy(ip, token);}
\DoxyCodeLine{377   }
\DoxyCodeLine{378   \textcolor{keywordflow}{return} ip;}
\DoxyCodeLine{379 \}}
\DoxyCodeLine{380 }
\DoxyCodeLine{388 \textcolor{keywordtype}{int} \mbox{\hyperlink{_n_b___r410_m_8h_ab8d8e04df5c4414751d4b1187175cdb3}{setCertMQTT}}(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *cert, \textcolor{keywordtype}{int} type, \textcolor{keyword}{const} \textcolor{keywordtype}{char} *name)}
\DoxyCodeLine{389 \{}
\DoxyCodeLine{390   \textcolor{keywordtype}{int} result = 0;}
\DoxyCodeLine{391   \textcolor{keywordtype}{char} *command = NULL;}
\DoxyCodeLine{392   \textcolor{keywordtype}{char} *response = NULL;}
\DoxyCodeLine{393   response = (\textcolor{keywordtype}{char} *)malloc(strlen(LTE\_SHIELD\_IMPORT\_CERT\_OK) + 5);}
\DoxyCodeLine{394   \textcolor{keywordflow}{if} (response == NULL)}
\DoxyCodeLine{395   \{}
\DoxyCodeLine{396     SerialMonitor.println(\textcolor{stringliteral}{"{}Malloc failed"{}});}
\DoxyCodeLine{397     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{398   \}}
\DoxyCodeLine{399   command = (\textcolor{keywordtype}{char} *)malloc((strlen(AT) + strlen(LTE\_SHIELD\_IMPORT\_CERT) + strlen(cert) + strlen(name) + 15));}
\DoxyCodeLine{400   \textcolor{keywordflow}{if} (command == NULL)}
\DoxyCodeLine{401   \{}
\DoxyCodeLine{402     SerialMonitor.println(\textcolor{stringliteral}{"{}Malloc failed"{}});}
\DoxyCodeLine{403     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{404   \}}
\DoxyCodeLine{405   sprintf(command, \textcolor{stringliteral}{"{}\%s\%s\%d,\(\backslash\)"{}\%s\(\backslash\)"{},\%d"{}}, AT, LTE\_SHIELD\_IMPORT\_CERT, type, name, strlen(cert));}
\DoxyCodeLine{406   SerialMonitor.printf(\textcolor{stringliteral}{"{}Importing certificate: \%s\(\backslash\)n"{}}, name);}
\DoxyCodeLine{407   \textcolor{comment}{// SerialMonitor.printf("{}Command: \%s\(\backslash\)n"{}, command);}}
\DoxyCodeLine{408   \textcolor{comment}{//  Empties buffer and transmits the command}}
\DoxyCodeLine{409   \mbox{\hyperlink{_n_b___r410_m_8h_a301d0294e9c5137ccbc922d3bf7831aa}{transmitCommand}}(command);}
\DoxyCodeLine{410 }
\DoxyCodeLine{411   \textcolor{keywordflow}{if} (\mbox{\hyperlink{_n_b___r410_m_8h_a2540498d294eca76534a8015310df26d}{getResponse}}(LTE\_SHIELD\_IMPORT\_CERT\_READY, 10000))}
\DoxyCodeLine{412   \{}
\DoxyCodeLine{413     SerialMonitor.println(\textcolor{stringliteral}{"{}Ready to receive certificate:"{}});}
\DoxyCodeLine{414     \textcolor{comment}{// SerialMonitor.printf("{}\%s\(\backslash\)n"{},cert);}}
\DoxyCodeLine{415 }
\DoxyCodeLine{416     sprintf(response, \textcolor{stringliteral}{"{}\%s\%d"{}}, LTE\_SHIELD\_IMPORT\_CERT\_OK, type);}
\DoxyCodeLine{417 }
\DoxyCodeLine{418     \textcolor{comment}{// Empties buffer and transmits the command}}
\DoxyCodeLine{419     \mbox{\hyperlink{_n_b___r410_m_8h_a301d0294e9c5137ccbc922d3bf7831aa}{transmitCommand}}(cert);}
\DoxyCodeLine{420 }
\DoxyCodeLine{421     \textcolor{keywordflow}{if} (\mbox{\hyperlink{_n_b___r410_m_8h_a2540498d294eca76534a8015310df26d}{getResponse}}(response, 10000))}
\DoxyCodeLine{422     \{}
\DoxyCodeLine{423       SerialMonitor.println(\textcolor{stringliteral}{"{}Certificate imported"{}});}
\DoxyCodeLine{424       result = 1;}
\DoxyCodeLine{425     \}}
\DoxyCodeLine{426     \textcolor{keywordflow}{else}}
\DoxyCodeLine{427     \{}
\DoxyCodeLine{428       SerialMonitor.println(\textcolor{stringliteral}{"{}Certificate import failed"{}});}
\DoxyCodeLine{429     \}}
\DoxyCodeLine{430   \}}
\DoxyCodeLine{431   \textcolor{keywordflow}{else}}
\DoxyCodeLine{432   \{}
\DoxyCodeLine{433     SerialMonitor.println(\textcolor{stringliteral}{"{}Failed to import certificate -\/ not ready"{}});}
\DoxyCodeLine{434   \}}
\DoxyCodeLine{435   free(command);}
\DoxyCodeLine{436   free(response);}
\DoxyCodeLine{437   \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{438 \}}
\DoxyCodeLine{439 }
\DoxyCodeLine{445 \textcolor{keywordtype}{int} \mbox{\hyperlink{_n_b___r410_m_8h_a8c739d69e197ff1a6d151e981a268641}{setMQTTping}}(\textcolor{keywordtype}{int} timeout)}
\DoxyCodeLine{446 \{}
\DoxyCodeLine{447   \textcolor{keywordtype}{int} result = 0;}
\DoxyCodeLine{448   \textcolor{keywordtype}{char} *command = NULL;}
\DoxyCodeLine{449 }
\DoxyCodeLine{450   command = (\textcolor{keywordtype}{char} *)malloc(strlen(AT) + strlen(LTE\_SHIELD\_TIMEOUT) + 5);}
\DoxyCodeLine{451   \textcolor{keywordflow}{if} (command == NULL)}
\DoxyCodeLine{452   \{}
\DoxyCodeLine{453     SerialMonitor.println(\textcolor{stringliteral}{"{}Malloc failed"{}});}
\DoxyCodeLine{454     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{455   \}}
\DoxyCodeLine{456   sprintf(command, \textcolor{stringliteral}{"{}\%s\%s\%d"{}}, AT, LTE\_SHIELD\_TIMEOUT, timeout);}
\DoxyCodeLine{457 }
\DoxyCodeLine{458   \textcolor{comment}{// Empties buffer and transmits the command}}
\DoxyCodeLine{459   \mbox{\hyperlink{_n_b___r410_m_8h_a301d0294e9c5137ccbc922d3bf7831aa}{transmitCommand}}(command);}
\DoxyCodeLine{460 }
\DoxyCodeLine{461   \textcolor{comment}{// Wait for the response}}
\DoxyCodeLine{462   \textcolor{keywordflow}{if} (\mbox{\hyperlink{_n_b___r410_m_8h_a2540498d294eca76534a8015310df26d}{getResponse}}(LTE\_SHIELD\_TIMEOUT\_SET\_RESPONSE, 10000))}
\DoxyCodeLine{463   \{}
\DoxyCodeLine{464     SerialMonitor.println(\textcolor{stringliteral}{"{}MQTT ping timeout set to "{}} + String(timeout));}
\DoxyCodeLine{465     result = 1;}
\DoxyCodeLine{466   \}}
\DoxyCodeLine{467   \textcolor{keywordflow}{else}}
\DoxyCodeLine{468   \{}
\DoxyCodeLine{469     SerialMonitor.println(\textcolor{stringliteral}{"{}Error setting MQTT ping timeout"{}});}
\DoxyCodeLine{470   \}}
\DoxyCodeLine{471   free(command);}
\DoxyCodeLine{472   \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{473 \}}
\DoxyCodeLine{474 }
\DoxyCodeLine{479 \textcolor{keywordtype}{int} \mbox{\hyperlink{_n_b___r410_m_8h_ae3585e6376929a7f5de0b8243b313e98}{enableMQTTkeepalive}}()}
\DoxyCodeLine{480 \{}
\DoxyCodeLine{481   \textcolor{keywordtype}{int} result = 0;}
\DoxyCodeLine{482   \textcolor{keywordtype}{char} *command = NULL;}
\DoxyCodeLine{483 }
\DoxyCodeLine{484   command = (\textcolor{keywordtype}{char} *)malloc(strlen(AT) + strlen(LTE\_SHIELD\_PING) + 5);}
\DoxyCodeLine{485   \textcolor{keywordflow}{if} (command == NULL)}
\DoxyCodeLine{486   \{}
\DoxyCodeLine{487     SerialMonitor.println(\textcolor{stringliteral}{"{}Malloc failed"{}});}
\DoxyCodeLine{488     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{489   \}}
\DoxyCodeLine{490   sprintf(command, \textcolor{stringliteral}{"{}\%s\%s"{}}, AT, LTE\_SHIELD\_PING);}
\DoxyCodeLine{491 }
\DoxyCodeLine{492   \textcolor{comment}{// Empties buffer and transmits the command}}
\DoxyCodeLine{493   \mbox{\hyperlink{_n_b___r410_m_8h_a301d0294e9c5137ccbc922d3bf7831aa}{transmitCommand}}(command);}
\DoxyCodeLine{494 }
\DoxyCodeLine{495   \textcolor{comment}{// Wait for the response}}
\DoxyCodeLine{496   \textcolor{keywordflow}{if} (\mbox{\hyperlink{_n_b___r410_m_8h_a2540498d294eca76534a8015310df26d}{getResponse}}(LTE\_SHIELD\_PING\_OK, 10000))}
\DoxyCodeLine{497   \{}
\DoxyCodeLine{498     SerialMonitor.println(\textcolor{stringliteral}{"{}MQTT keepalive enabled"{}});}
\DoxyCodeLine{499     result = 1;}
\DoxyCodeLine{500   \}}
\DoxyCodeLine{501   \textcolor{keywordflow}{else}}
\DoxyCodeLine{502   \{}
\DoxyCodeLine{503     SerialMonitor.println(\textcolor{stringliteral}{"{}Error enabling MQTT keepalive"{}});}
\DoxyCodeLine{504   \}}
\DoxyCodeLine{505   free(command);}
\DoxyCodeLine{506   \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{507 \}}
\DoxyCodeLine{508 }
\DoxyCodeLine{517 \textcolor{keywordtype}{int} \mbox{\hyperlink{_n_b___r410_m_8h_a92d55d9f690d1e2c337f035700ef5a4e}{publishMessage}}(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *topic, \textcolor{keyword}{const} \textcolor{keywordtype}{char} *message, \textcolor{keywordtype}{int} QoS, \textcolor{keywordtype}{int} retain)}
\DoxyCodeLine{518 \{}
\DoxyCodeLine{519   \textcolor{keywordtype}{int} result = 0;}
\DoxyCodeLine{520   \textcolor{keywordtype}{char} *command = NULL;}
\DoxyCodeLine{521 }
\DoxyCodeLine{522   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} LTE\_SHIELD\_SEND\_TIMEOUT = 60000;}
\DoxyCodeLine{523 }
\DoxyCodeLine{524   \textcolor{comment}{// SerialMonitor.printf("{}Allocating memory for command\(\backslash\)n"{});}}
\DoxyCodeLine{525   command = (\textcolor{keywordtype}{char} *)malloc(strlen(AT) + strlen(LTE\_SHIELD\_SEND\_MQTT) + strlen(message) + strlen(topic) + 8);}
\DoxyCodeLine{526   \textcolor{keywordflow}{if} (command == NULL)}
\DoxyCodeLine{527   \{}
\DoxyCodeLine{528     SerialMonitor.printf(\textcolor{stringliteral}{"{}Memory allocation failed\(\backslash\)n"{}});}
\DoxyCodeLine{529     \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{530   \}}
\DoxyCodeLine{531   \textcolor{comment}{// SerialMonitor.printf("{}Building command\(\backslash\)n"{});}}
\DoxyCodeLine{532   sprintf(command, \textcolor{stringliteral}{"{}\%s\%s,\%d,\%d,\%s,\%s"{}}, AT, LTE\_SHIELD\_SEND\_MQTT, QoS, retain, topic, message);}
\DoxyCodeLine{533 }
\DoxyCodeLine{534   \textcolor{comment}{// SerialMonitor.printf("{}Command built....Sending\(\backslash\)n"{});}}
\DoxyCodeLine{535 }
\DoxyCodeLine{536   \textcolor{comment}{// Empties buffer and transmits the command}}
\DoxyCodeLine{537   \mbox{\hyperlink{_n_b___r410_m_8h_a301d0294e9c5137ccbc922d3bf7831aa}{transmitCommand}}(command);}
\DoxyCodeLine{538 }
\DoxyCodeLine{539   \textcolor{comment}{// SerialMonitor.printf("{}Command sent....Waiting for response\(\backslash\)n"{});}}
\DoxyCodeLine{540   \textcolor{keywordflow}{if} (\mbox{\hyperlink{_n_b___r410_m_8h_a2540498d294eca76534a8015310df26d}{getResponse}}(LTE\_SHIELD\_SEND\_OK, LTE\_SHIELD\_SEND\_TIMEOUT))}
\DoxyCodeLine{541   \{}
\DoxyCodeLine{542     SerialMonitor.println(\textcolor{stringliteral}{"{}Message sent"{}});}
\DoxyCodeLine{543     result = 1;}
\DoxyCodeLine{544   \}}
\DoxyCodeLine{545   \textcolor{keywordflow}{else}}
\DoxyCodeLine{546   \{}
\DoxyCodeLine{547     SerialMonitor.println(\textcolor{stringliteral}{"{}Error sending message"{}});}
\DoxyCodeLine{548   \}}
\DoxyCodeLine{549 }
\DoxyCodeLine{550   free(command);}
\DoxyCodeLine{551   \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{552 \}}
\DoxyCodeLine{553 }
\DoxyCodeLine{558 \textcolor{keywordtype}{int} \mbox{\hyperlink{_n_b___r410_m_8h_ae0c1031eb25784bc3a5ab60e8f3981bf}{loginMQTT}}()}
\DoxyCodeLine{559 \{}
\DoxyCodeLine{560   \textcolor{keywordtype}{int} result = 0;}
\DoxyCodeLine{561   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} LTE\_SHIELD\_IP\_CONNECT\_TIMEOUT = 60000;}
\DoxyCodeLine{562 }
\DoxyCodeLine{563   SerialMonitor.printf(\textcolor{stringliteral}{"{}Sending login command: \%s\(\backslash\)n"{}}, LTE\_SHIELD\_LOGIN);}
\DoxyCodeLine{564   \textcolor{comment}{// Empties buffer and transmits the command}}
\DoxyCodeLine{565   \mbox{\hyperlink{_n_b___r410_m_8h_a301d0294e9c5137ccbc922d3bf7831aa}{transmitCommand}}(LTE\_SHIELD\_LOGIN);}
\DoxyCodeLine{566 }
\DoxyCodeLine{567   \textcolor{keywordflow}{if} (\mbox{\hyperlink{_n_b___r410_m_8h_a2540498d294eca76534a8015310df26d}{getResponse}}(LTE\_SHIELD\_LOGIN\_OK, LTE\_SHIELD\_IP\_CONNECT\_TIMEOUT))}
\DoxyCodeLine{568   \{}
\DoxyCodeLine{569     SerialMonitor.println(\textcolor{stringliteral}{"{}MQTT login successful"{}});}
\DoxyCodeLine{570     result = 1;}
\DoxyCodeLine{571   \}}
\DoxyCodeLine{572   \textcolor{keywordflow}{else}}
\DoxyCodeLine{573   \{}
\DoxyCodeLine{574     SerialMonitor.println(\textcolor{stringliteral}{"{}Error logging in to MQTT"{}});}
\DoxyCodeLine{575   \}}
\DoxyCodeLine{576   \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{577 \}}
\DoxyCodeLine{578 }
\DoxyCodeLine{584 \textcolor{keywordtype}{int} \mbox{\hyperlink{_n_b___r410_m_8h_a05ff32195e69fc3d74b5bcd78781c5df}{willconfigMQTT}}(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *topic)}
\DoxyCodeLine{585 \{}
\DoxyCodeLine{586   \textcolor{keywordtype}{int} result = 0;}
\DoxyCodeLine{587   \textcolor{keywordtype}{char} *command = NULL;}
\DoxyCodeLine{588   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} LTE\_SHIELD\_IP\_CONNECT\_TIMEOUT = 10000;}
\DoxyCodeLine{589 }
\DoxyCodeLine{590   command = (\textcolor{keywordtype}{char} *)malloc(strlen(AT) + strlen(LTE\_SHIELD\_WILL\_TOPIC\_MQTT) + strlen(topic) + 10);}
\DoxyCodeLine{591   \textcolor{keywordflow}{if} (command == NULL)}
\DoxyCodeLine{592   \{}
\DoxyCodeLine{593     SerialMonitor.println(\textcolor{stringliteral}{"{}Malloc failed"{}});}
\DoxyCodeLine{594     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{595   \}}
\DoxyCodeLine{596   sprintf(command, \textcolor{stringliteral}{"{}\%s\%s\%d,\%d,\(\backslash\)"{}\%s\(\backslash\)"{}"{}}, AT, LTE\_SHIELD\_WILL\_TOPIC\_MQTT, 0, 0, topic);}
\DoxyCodeLine{597 }
\DoxyCodeLine{598   SerialMonitor.printf(\textcolor{stringliteral}{"{}Sending will topic command: \%s\(\backslash\)n"{}}, command);}
\DoxyCodeLine{599   \textcolor{comment}{// Empties buffer and transmits the command}}
\DoxyCodeLine{600   \mbox{\hyperlink{_n_b___r410_m_8h_a301d0294e9c5137ccbc922d3bf7831aa}{transmitCommand}}(command);}
\DoxyCodeLine{601 }
\DoxyCodeLine{602   \textcolor{keywordflow}{if} (\mbox{\hyperlink{_n_b___r410_m_8h_a2540498d294eca76534a8015310df26d}{getResponse}}(LTE\_SHIELD\_TOPIC\_OK, LTE\_SHIELD\_IP\_CONNECT\_TIMEOUT))}
\DoxyCodeLine{603   \{}
\DoxyCodeLine{604     Serial.println(\textcolor{stringliteral}{"{}Will topic set"{}});}
\DoxyCodeLine{605     result = 1;}
\DoxyCodeLine{606   \}}
\DoxyCodeLine{607   \textcolor{keywordflow}{else}}
\DoxyCodeLine{608   \{}
\DoxyCodeLine{609     Serial.println(\textcolor{stringliteral}{"{}Will topic not set"{}});}
\DoxyCodeLine{610   \}}
\DoxyCodeLine{611 }
\DoxyCodeLine{612   free(command);}
\DoxyCodeLine{613 }
\DoxyCodeLine{614   \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{615 \}}
\DoxyCodeLine{616 }
\DoxyCodeLine{622 \textcolor{keywordtype}{int} \mbox{\hyperlink{_n_b___r410_m_8h_adad4ab35b4d191aaed39087329867277}{willmsgMQTT}}(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *message)}
\DoxyCodeLine{623 \{}
\DoxyCodeLine{624   \textcolor{keywordtype}{int} result = 0;}
\DoxyCodeLine{625   \textcolor{keywordtype}{char} *command = NULL;}
\DoxyCodeLine{626 }
\DoxyCodeLine{627   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} LTE\_SHIELD\_IP\_CONNECT\_TIMEOUT = 10000;}
\DoxyCodeLine{628 }
\DoxyCodeLine{629   command = (\textcolor{keywordtype}{char} *)malloc(strlen(AT) + strlen(LTE\_SHIELD\_WILL\_MESSAGE\_MQTT) + strlen(message) + 10);}
\DoxyCodeLine{630   \textcolor{keywordflow}{if} (command == NULL)}
\DoxyCodeLine{631   \{}
\DoxyCodeLine{632     SerialMonitor.println(\textcolor{stringliteral}{"{}Malloc failed"{}});}
\DoxyCodeLine{633     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{634   \}}
\DoxyCodeLine{635   sprintf(command, \textcolor{stringliteral}{"{}\%s\%s\(\backslash\)"{}\%s\(\backslash\)"{}"{}}, AT, LTE\_SHIELD\_WILL\_MESSAGE\_MQTT, message);}
\DoxyCodeLine{636 }
\DoxyCodeLine{637   SerialMonitor.printf(\textcolor{stringliteral}{"{}Sending will message command: \%s\(\backslash\)n"{}}, command);}
\DoxyCodeLine{638   \textcolor{comment}{// Empties buffer and transmits the command}}
\DoxyCodeLine{639   \mbox{\hyperlink{_n_b___r410_m_8h_a301d0294e9c5137ccbc922d3bf7831aa}{transmitCommand}}(command);}
\DoxyCodeLine{640 }
\DoxyCodeLine{641   \textcolor{keywordflow}{if} (\mbox{\hyperlink{_n_b___r410_m_8h_a2540498d294eca76534a8015310df26d}{getResponse}}(LTE\_SHIELD\_MESSAGE\_OK, LTE\_SHIELD\_IP\_CONNECT\_TIMEOUT))}
\DoxyCodeLine{642   \{}
\DoxyCodeLine{643     Serial.println(\textcolor{stringliteral}{"{}Will message set"{}});}
\DoxyCodeLine{644     result = 1;}
\DoxyCodeLine{645   \}}
\DoxyCodeLine{646   \textcolor{keywordflow}{else}}
\DoxyCodeLine{647   \{}
\DoxyCodeLine{648     Serial.println(\textcolor{stringliteral}{"{}Will message not set"{}});}
\DoxyCodeLine{649   \}}
\DoxyCodeLine{650   free(command);}
\DoxyCodeLine{651   \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{652 \}}
\DoxyCodeLine{653 }
\DoxyCodeLine{660 \textcolor{keywordtype}{int} \mbox{\hyperlink{_n_b___r410_m_8h_ac0f44c06684338d6571b119289066fce}{setMQTT}}(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *host, \textcolor{keywordtype}{int} port)}
\DoxyCodeLine{661 \{}
\DoxyCodeLine{662   \textcolor{keywordtype}{int} result = 0;}
\DoxyCodeLine{663   \textcolor{keywordtype}{char} *command = NULL;}
\DoxyCodeLine{664 }
\DoxyCodeLine{665   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} LTE\_SHIELD\_IP\_CONNECT\_TIMEOUT = 10000;}
\DoxyCodeLine{666 }
\DoxyCodeLine{667   command = (\textcolor{keywordtype}{char} *)malloc(\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{char}) * (strlen(LTE\_SHIELD\_CONNECT\_MQTT) + strlen(host) + 15));}
\DoxyCodeLine{668   \textcolor{keywordflow}{if} (command == NULL)}
\DoxyCodeLine{669   \{}
\DoxyCodeLine{670     SerialMonitor.println(\textcolor{stringliteral}{"{}Malloc failed"{}});}
\DoxyCodeLine{671     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{672   \}}
\DoxyCodeLine{673 }
\DoxyCodeLine{674   \textcolor{comment}{// Create the command}}
\DoxyCodeLine{675   sprintf(command, \textcolor{stringliteral}{"{}AT\%s=\%d,\(\backslash\)"{}\%s\(\backslash\)"{},\%d"{}}, LTE\_SHIELD\_CONNECT\_MQTT, 2, host, port);}
\DoxyCodeLine{676   \textcolor{comment}{// Send the command}}
\DoxyCodeLine{677   SerialMonitor.println(\textcolor{stringliteral}{"{}Setting MQTT hostname \& port"{}});}
\DoxyCodeLine{678 }
\DoxyCodeLine{679   \textcolor{comment}{// Empties buffer and transmits the command}}
\DoxyCodeLine{680   \mbox{\hyperlink{_n_b___r410_m_8h_a301d0294e9c5137ccbc922d3bf7831aa}{transmitCommand}}(command);}
\DoxyCodeLine{681 }
\DoxyCodeLine{682   \textcolor{comment}{// Wait for the response}}
\DoxyCodeLine{683   \textcolor{keywordflow}{if} (\mbox{\hyperlink{_n_b___r410_m_8h_a2540498d294eca76534a8015310df26d}{getResponse}}(LTE\_SHIELD\_RESPONSE\_OK, LTE\_SHIELD\_IP\_CONNECT\_TIMEOUT))}
\DoxyCodeLine{684   \{}
\DoxyCodeLine{685     Serial.println(\textcolor{stringliteral}{"{}MQTT hostname \& port set"{}});}
\DoxyCodeLine{686     result = 1;}
\DoxyCodeLine{687   \}}
\DoxyCodeLine{688   \textcolor{keywordflow}{else}}
\DoxyCodeLine{689   \{}
\DoxyCodeLine{690     Serial.println(\textcolor{stringliteral}{"{}MQTT hostname \& port not set"{}});}
\DoxyCodeLine{691   \}}
\DoxyCodeLine{692 }
\DoxyCodeLine{693   free(command);}
\DoxyCodeLine{694   \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{695 \}}

\end{DoxyCode}
