\hypertarget{_n_b___r410_m_8h_source}{}\doxysection{NB\+\_\+\+R410\+M.\+h}
\label{_n_b___r410_m_8h_source}\index{src/NB\_R410M.h@{src/NB\_R410M.h}}
\mbox{\hyperlink{_n_b___r410_m_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 }
\DoxyCodeLine{29 \textcolor{preprocessor}{\#include <Arduino.h>}}
\DoxyCodeLine{30 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_a_t__commands_8h}{AT\_commands.h}}"{}}}
\DoxyCodeLine{31 \textcolor{preprocessor}{\#include <HardwareSerial.h>}}
\DoxyCodeLine{32 \textcolor{preprocessor}{\#include "{}SPIFFS.h"{}}}
\DoxyCodeLine{33 }
\DoxyCodeLine{34 HardwareSerial lteSerial(2);}
\DoxyCodeLine{35 }
\DoxyCodeLine{36 \textcolor{preprocessor}{\#define SerialMonitor Serial}}
\DoxyCodeLine{37 \textcolor{preprocessor}{\#define LTEShieldSerial lteSerial}}
\DoxyCodeLine{38 }
\DoxyCodeLine{43 \textcolor{keywordtype}{void} \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *text)}
\DoxyCodeLine{44 \{}
\DoxyCodeLine{45   SerialMonitor.print(text);}
\DoxyCodeLine{46 \}}
\DoxyCodeLine{47 }
\DoxyCodeLine{52 \textcolor{keywordtype}{void} \mbox{\hyperlink{_n_b___r410_m_8h_a301d0294e9c5137ccbc922d3bf7831aa}{transmitCommand}}(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *command)}
\DoxyCodeLine{53 \{}
\DoxyCodeLine{54   \textcolor{comment}{// printToConsole("{}Command: \%s\(\backslash\)n"{}, command);}}
\DoxyCodeLine{55   \textcolor{comment}{//  Empty the serial buffer}}
\DoxyCodeLine{56   \textcolor{keywordflow}{while} (LTEShieldSerial.available())}
\DoxyCodeLine{57   \{}
\DoxyCodeLine{58     LTEShieldSerial.read();}
\DoxyCodeLine{59   \}}
\DoxyCodeLine{60   \textcolor{comment}{// Transmit the command}}
\DoxyCodeLine{61   LTEShieldSerial.print(command);}
\DoxyCodeLine{62   LTEShieldSerial.print(\textcolor{stringliteral}{"{}\(\backslash\)r"{}});}
\DoxyCodeLine{63 \}}
\DoxyCodeLine{64 }
\DoxyCodeLine{71 \textcolor{keywordtype}{int} \mbox{\hyperlink{_n_b___r410_m_8h_a2540498d294eca76534a8015310df26d}{getResponse}}(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *response, \textcolor{keywordtype}{int} timeout)}
\DoxyCodeLine{72 \{}
\DoxyCodeLine{73   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} timeIn = millis();}
\DoxyCodeLine{74   \textcolor{keywordtype}{char} ret[128];}
\DoxyCodeLine{75   \textcolor{keywordtype}{int} destIndex = 0;}
\DoxyCodeLine{76   \textcolor{keywordtype}{int} index = 0;}
\DoxyCodeLine{77   \textcolor{keywordtype}{char} c;}
\DoxyCodeLine{78   \textcolor{keywordtype}{int} size = strlen(response);}
\DoxyCodeLine{79 }
\DoxyCodeLine{80   \textcolor{keywordflow}{while} (millis() -\/ timeIn < timeout)}
\DoxyCodeLine{81   \{}
\DoxyCodeLine{82     \textcolor{keywordflow}{if} (LTEShieldSerial.available())}
\DoxyCodeLine{83     \{}
\DoxyCodeLine{84       c = (char)LTEShieldSerial.read();}
\DoxyCodeLine{85       \textcolor{comment}{//Serial.print(c);}}
\DoxyCodeLine{86       ret[destIndex++] = c;}
\DoxyCodeLine{87 }
\DoxyCodeLine{88       \textcolor{keywordflow}{if} (c == response[index])}
\DoxyCodeLine{89       \{}
\DoxyCodeLine{90         index++;}
\DoxyCodeLine{91         \textcolor{keywordflow}{if} (index == size)}
\DoxyCodeLine{92         \{}
\DoxyCodeLine{93           \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{94         \}}
\DoxyCodeLine{95       \}}
\DoxyCodeLine{96       \textcolor{keywordflow}{else}}
\DoxyCodeLine{97       \{}
\DoxyCodeLine{98         index = 0;}
\DoxyCodeLine{99       \}}
\DoxyCodeLine{100     \}}
\DoxyCodeLine{101   \}}
\DoxyCodeLine{102   ret[destIndex] = \textcolor{charliteral}{'\(\backslash\)0'};}
\DoxyCodeLine{103   \textcolor{comment}{//Serial.println(ret);}}
\DoxyCodeLine{104   \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{105 \}}
\DoxyCodeLine{106 }
\DoxyCodeLine{112 \textcolor{keywordtype}{int} \mbox{\hyperlink{_n_b___r410_m_8h_a66f862d5c7d16623b90ccf294c1cf055}{initModule}}(\textcolor{keywordtype}{int} timeout)}
\DoxyCodeLine{113 \{}
\DoxyCodeLine{114   LTEShieldSerial.begin(115200);}
\DoxyCodeLine{115   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} startTime = millis();}
\DoxyCodeLine{116   }
\DoxyCodeLine{117   \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Transmitting AT\(\backslash\)n"{}});}
\DoxyCodeLine{118   \textcolor{keywordflow}{while} (!\mbox{\hyperlink{_n_b___r410_m_8h_a2540498d294eca76534a8015310df26d}{getResponse}}(\textcolor{stringliteral}{"{}OK"{}}, 500))}
\DoxyCodeLine{119   \{}
\DoxyCodeLine{120     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}."{}});}
\DoxyCodeLine{121     \mbox{\hyperlink{_n_b___r410_m_8h_a301d0294e9c5137ccbc922d3bf7831aa}{transmitCommand}}(\textcolor{stringliteral}{"{}AT"{}}); \textcolor{comment}{// Send AT command to enable the interface}}
\DoxyCodeLine{122     }
\DoxyCodeLine{123     \textcolor{keywordflow}{if} (millis() -\/ startTime > timeout)}
\DoxyCodeLine{124     \{}
\DoxyCodeLine{125       \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{126     \}}
\DoxyCodeLine{127   \}}
\DoxyCodeLine{128   \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Got OK\(\backslash\)n"{}});}
\DoxyCodeLine{129 }
\DoxyCodeLine{130   \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Disabling echo\(\backslash\)n"{}});}
\DoxyCodeLine{131   \mbox{\hyperlink{_n_b___r410_m_8h_a301d0294e9c5137ccbc922d3bf7831aa}{transmitCommand}}(\textcolor{stringliteral}{"{}ATE0"{}}); \textcolor{comment}{// Disable echo}}
\DoxyCodeLine{132   \textcolor{keywordflow}{if} (\mbox{\hyperlink{_n_b___r410_m_8h_a2540498d294eca76534a8015310df26d}{getResponse}}(\textcolor{stringliteral}{"{}OK"{}}, 200))}
\DoxyCodeLine{133   \{}
\DoxyCodeLine{134     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Echo disabled\(\backslash\)n"{}});}
\DoxyCodeLine{135   \}}
\DoxyCodeLine{136   \textcolor{keywordflow}{else}}
\DoxyCodeLine{137   \{}
\DoxyCodeLine{138     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Echo not disabled\(\backslash\)n"{}});}
\DoxyCodeLine{139   \}}
\DoxyCodeLine{140 }
\DoxyCodeLine{141   \mbox{\hyperlink{_n_b___r410_m_8h_a301d0294e9c5137ccbc922d3bf7831aa}{transmitCommand}}(\textcolor{stringliteral}{"{}AT+CTZU=1"{}}); \textcolor{comment}{// Enable automatic time zone update}}
\DoxyCodeLine{142   \textcolor{keywordflow}{if} (\mbox{\hyperlink{_n_b___r410_m_8h_a2540498d294eca76534a8015310df26d}{getResponse}}(\textcolor{stringliteral}{"{}OK"{}}, 5000))}
\DoxyCodeLine{143   \{}
\DoxyCodeLine{144     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Automatic time zone update enabled\(\backslash\)n"{}});}
\DoxyCodeLine{145   \}}
\DoxyCodeLine{146   \textcolor{keywordflow}{else}}
\DoxyCodeLine{147   \{}
\DoxyCodeLine{148     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Automatic time zone update not enabled\(\backslash\)n"{}});}
\DoxyCodeLine{149   \}}
\DoxyCodeLine{150 }
\DoxyCodeLine{151   \mbox{\hyperlink{_n_b___r410_m_8h_a301d0294e9c5137ccbc922d3bf7831aa}{transmitCommand}}(\textcolor{stringliteral}{"{}AT+UGPIOC=16,2"{}}); \textcolor{comment}{// Set GPIO16 to indicate network status}}
\DoxyCodeLine{152   \textcolor{keywordflow}{if} (\mbox{\hyperlink{_n_b___r410_m_8h_a2540498d294eca76534a8015310df26d}{getResponse}}(\textcolor{stringliteral}{"{}OK"{}}, 5000))}
\DoxyCodeLine{153   \{}
\DoxyCodeLine{154     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}GPIO16 set to indicate network status\(\backslash\)n"{}});}
\DoxyCodeLine{155   \}}
\DoxyCodeLine{156   \textcolor{keywordflow}{else}}
\DoxyCodeLine{157   \{}
\DoxyCodeLine{158     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}GPIO16 not set to indicate network status\(\backslash\)n"{}});}
\DoxyCodeLine{159   \}}
\DoxyCodeLine{160 }
\DoxyCodeLine{161   \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{162 \}}
\DoxyCodeLine{168 \textcolor{keywordtype}{int} \mbox{\hyperlink{_n_b___r410_m_8h_a45ea19fd14a7f7c3d7803940c809dec8}{enableSSL}}(\textcolor{keywordtype}{int} profile)}
\DoxyCodeLine{169 \{}
\DoxyCodeLine{170   \textcolor{keywordtype}{char} *command = NULL;}
\DoxyCodeLine{171   command = (\textcolor{keywordtype}{char} *)malloc(strlen(AT) + strlen(SARA\_MQTT\_SECURE) + 5);}
\DoxyCodeLine{172   \textcolor{keywordflow}{if} (command == NULL)}
\DoxyCodeLine{173   \{}
\DoxyCodeLine{174     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Malloc failed"{}});}
\DoxyCodeLine{175     \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{176   \}}
\DoxyCodeLine{177 }
\DoxyCodeLine{178   sprintf(command, \textcolor{stringliteral}{"{}\%s\%s\%d"{}}, AT, SARA\_MQTT\_SECURE, profile);}
\DoxyCodeLine{179   \mbox{\hyperlink{_n_b___r410_m_8h_a301d0294e9c5137ccbc922d3bf7831aa}{transmitCommand}}(command);}
\DoxyCodeLine{180   \textcolor{keywordflow}{if} (\mbox{\hyperlink{_n_b___r410_m_8h_a2540498d294eca76534a8015310df26d}{getResponse}}(SARA\_MQTT\_SECURE\_SET\_RESPONSE, 5000))}
\DoxyCodeLine{181   \{}
\DoxyCodeLine{182     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}SSL enabled"{}});}
\DoxyCodeLine{183     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{184   \}}
\DoxyCodeLine{185   \textcolor{keywordflow}{else}}
\DoxyCodeLine{186   \{}
\DoxyCodeLine{187     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}SSL not enabled"{}});}
\DoxyCodeLine{188     \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{189   \}}
\DoxyCodeLine{190 \}}
\DoxyCodeLine{191 }
\DoxyCodeLine{199 \textcolor{keywordtype}{int} \mbox{\hyperlink{_n_b___r410_m_8h_a2b3052c267ca2e25a73b972c5dead26b}{assignCert}}(\textcolor{keywordtype}{int} profile, \textcolor{keyword}{const} \textcolor{keywordtype}{char} *certName, \textcolor{keywordtype}{int} certType)}
\DoxyCodeLine{200 \{}
\DoxyCodeLine{201   \textcolor{keywordtype}{int} returnVal = 1;}
\DoxyCodeLine{202   \textcolor{keywordtype}{char} *command = NULL;}
\DoxyCodeLine{203   command = (\textcolor{keywordtype}{char} *)malloc(strlen(AT) + strlen(SARA\_SECURITY\_PROFILE) + strlen(certName) + 10);}
\DoxyCodeLine{204   \textcolor{keywordflow}{if} (command == NULL)}
\DoxyCodeLine{205   \{}
\DoxyCodeLine{206     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Malloc failed"{}});}
\DoxyCodeLine{207     \textcolor{keywordflow}{return} 2;}
\DoxyCodeLine{208   \}}
\DoxyCodeLine{209   sprintf(command, \textcolor{stringliteral}{"{}\%s\%s\%d,\%d,\(\backslash\)"{}\%s\(\backslash\)"{}"{}}, AT, SARA\_SECURITY\_PROFILE, profile, certType, certName);}
\DoxyCodeLine{210   \mbox{\hyperlink{_n_b___r410_m_8h_a301d0294e9c5137ccbc922d3bf7831aa}{transmitCommand}}(command);}
\DoxyCodeLine{211   \textcolor{keywordflow}{if} (\mbox{\hyperlink{_n_b___r410_m_8h_a2540498d294eca76534a8015310df26d}{getResponse}}(\textcolor{stringliteral}{"{}OK"{}},1000))}
\DoxyCodeLine{212   \{}
\DoxyCodeLine{213     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Certificate ["{}});}
\DoxyCodeLine{214     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(certName);}
\DoxyCodeLine{215     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}] assigned\(\backslash\)n"{}});}
\DoxyCodeLine{216     returnVal = 0;}
\DoxyCodeLine{217   \}}
\DoxyCodeLine{218   \textcolor{keywordflow}{else}}
\DoxyCodeLine{219   \{}
\DoxyCodeLine{220     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Certificate ["{}});}
\DoxyCodeLine{221     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(certName);}
\DoxyCodeLine{222     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}] not assigned\(\backslash\)n"{}});}
\DoxyCodeLine{223     returnVal = 1;}
\DoxyCodeLine{224   \}}
\DoxyCodeLine{225   free(command);}
\DoxyCodeLine{226   \textcolor{keywordflow}{return} returnVal;}
\DoxyCodeLine{227 \}}
\DoxyCodeLine{228 }
\DoxyCodeLine{232 \textcolor{keywordtype}{void} \mbox{\hyperlink{_n_b___r410_m_8h_aa6f75e9b70b0ada28fb438225a155bbb}{getNetwork}}()}
\DoxyCodeLine{233 \{}
\DoxyCodeLine{234   \textcolor{keywordtype}{int} retval;}
\DoxyCodeLine{235   \textcolor{keywordtype}{int} last = 99;}
\DoxyCodeLine{236   \textcolor{keywordflow}{while} (retval != 1)}
\DoxyCodeLine{237   \{}
\DoxyCodeLine{238 }
\DoxyCodeLine{239     \textcolor{comment}{// Empty the serial buffer}}
\DoxyCodeLine{240     \textcolor{keywordflow}{while} (LTEShieldSerial.available())}
\DoxyCodeLine{241     \{}
\DoxyCodeLine{242       LTEShieldSerial.read();}
\DoxyCodeLine{243     \}}
\DoxyCodeLine{244     \mbox{\hyperlink{_n_b___r410_m_8h_a301d0294e9c5137ccbc922d3bf7831aa}{transmitCommand}}(\textcolor{stringliteral}{"{}AT+CEREG?"{}});}
\DoxyCodeLine{245     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} timeIn = millis();}
\DoxyCodeLine{246     \textcolor{keywordtype}{char} ret[128];}
\DoxyCodeLine{247     \textcolor{keywordtype}{int} destIndex = 0;}
\DoxyCodeLine{248     \textcolor{keywordtype}{int} index = 0;}
\DoxyCodeLine{249     \textcolor{keywordtype}{char} c;}
\DoxyCodeLine{250     \textcolor{keywordtype}{int} size = 12;}
\DoxyCodeLine{251     retval = 4;}
\DoxyCodeLine{252 }
\DoxyCodeLine{253     \textcolor{keywordflow}{while} (millis() -\/ timeIn < 1000)}
\DoxyCodeLine{254     \{}
\DoxyCodeLine{255       \textcolor{keywordflow}{if} (LTEShieldSerial.available())}
\DoxyCodeLine{256       \{}
\DoxyCodeLine{257         c = (char)LTEShieldSerial.read();}
\DoxyCodeLine{258         \textcolor{comment}{// Serial.print(c);}}
\DoxyCodeLine{259         ret[index++] = c;}
\DoxyCodeLine{260         \textcolor{comment}{// printToConsole("{}index: \%d\(\backslash\)n"{}, index);}}
\DoxyCodeLine{261         \textcolor{keywordflow}{if} (index > size)}
\DoxyCodeLine{262         \{}
\DoxyCodeLine{263           \textcolor{keywordflow}{break};}
\DoxyCodeLine{264         \}}
\DoxyCodeLine{265       \}}
\DoxyCodeLine{266     \}}
\DoxyCodeLine{267     ret[++index] = 0;}
\DoxyCodeLine{268     \textcolor{comment}{// printToConsole("{}ret: \%s\(\backslash\)n"{}, ret);}}
\DoxyCodeLine{269     sscanf(ret, \textcolor{stringliteral}{"{} +CEREG: 0,\%d"{}}, \&retval);}
\DoxyCodeLine{270     \textcolor{keywordflow}{switch} (retval)}
\DoxyCodeLine{271     \{}
\DoxyCodeLine{272     \textcolor{keywordflow}{case} 0:}
\DoxyCodeLine{273       \textcolor{keywordflow}{if} (last != retval)}
\DoxyCodeLine{274       \{}
\DoxyCodeLine{275         \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Not registered, MT is not currently searching a new operator to register to\(\backslash\)n"{}});}
\DoxyCodeLine{276         last = retval;}
\DoxyCodeLine{277       \}}
\DoxyCodeLine{278       \textcolor{keywordflow}{else}}
\DoxyCodeLine{279       \{}
\DoxyCodeLine{280         \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}."{}});}
\DoxyCodeLine{281       \}}
\DoxyCodeLine{282       \textcolor{keywordflow}{break};}
\DoxyCodeLine{283     \textcolor{keywordflow}{case} 1:}
\DoxyCodeLine{284       \textcolor{keywordflow}{if} (last != retval)}
\DoxyCodeLine{285       \{}
\DoxyCodeLine{286         \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Registered, home network\(\backslash\)n"{}});}
\DoxyCodeLine{287         last = retval;}
\DoxyCodeLine{288       \}}
\DoxyCodeLine{289       \textcolor{keywordflow}{else}}
\DoxyCodeLine{290       \{}
\DoxyCodeLine{291         \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}."{}});}
\DoxyCodeLine{292       \}}
\DoxyCodeLine{293       \textcolor{keywordflow}{break};}
\DoxyCodeLine{294     \textcolor{keywordflow}{case} 2:}
\DoxyCodeLine{295       \textcolor{keywordflow}{if} (last != retval)}
\DoxyCodeLine{296       \{}
\DoxyCodeLine{297         \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Scanning for network\(\backslash\)n"{}});}
\DoxyCodeLine{298         last = retval;}
\DoxyCodeLine{299       \}}
\DoxyCodeLine{300       \textcolor{keywordflow}{else}}
\DoxyCodeLine{301       \{}
\DoxyCodeLine{302         \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}."{}});}
\DoxyCodeLine{303       \}}
\DoxyCodeLine{304       \textcolor{keywordflow}{break};}
\DoxyCodeLine{305     \textcolor{keywordflow}{case} 3:}
\DoxyCodeLine{306       \textcolor{keywordflow}{if} (last != retval)}
\DoxyCodeLine{307       \{}
\DoxyCodeLine{308         \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Registration denied\(\backslash\)n"{}});}
\DoxyCodeLine{309         last = retval;}
\DoxyCodeLine{310       \}}
\DoxyCodeLine{311       \textcolor{keywordflow}{else}}
\DoxyCodeLine{312       \{}
\DoxyCodeLine{313         \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}."{}});}
\DoxyCodeLine{314       \}}
\DoxyCodeLine{315       \textcolor{keywordflow}{break};}
\DoxyCodeLine{316     \textcolor{keywordflow}{case} 4:}
\DoxyCodeLine{317       \textcolor{keywordflow}{if} (last != retval)}
\DoxyCodeLine{318       \{}
\DoxyCodeLine{319         \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Unknown\(\backslash\)n"{}});}
\DoxyCodeLine{320         last = retval;}
\DoxyCodeLine{321       \}}
\DoxyCodeLine{322       \textcolor{keywordflow}{else}}
\DoxyCodeLine{323       \{}
\DoxyCodeLine{324         \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}."{}});}
\DoxyCodeLine{325       \}}
\DoxyCodeLine{326       \textcolor{keywordflow}{break};}
\DoxyCodeLine{327     \textcolor{keywordflow}{case} 5:}
\DoxyCodeLine{328       \textcolor{keywordflow}{if} (last != retval)}
\DoxyCodeLine{329       \{}
\DoxyCodeLine{330         \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Registered, roaming\(\backslash\)n"{}});}
\DoxyCodeLine{331         last = retval;}
\DoxyCodeLine{332       \}}
\DoxyCodeLine{333       \textcolor{keywordflow}{else}}
\DoxyCodeLine{334       \{}
\DoxyCodeLine{335         \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}."{}});}
\DoxyCodeLine{336       \}}
\DoxyCodeLine{337       \textcolor{keywordflow}{break};}
\DoxyCodeLine{338     \textcolor{keywordflow}{default}:}
\DoxyCodeLine{339       \textcolor{keywordflow}{if} (last != retval)}
\DoxyCodeLine{340       \{}
\DoxyCodeLine{341         \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Unknown\(\backslash\)n"{}});}
\DoxyCodeLine{342         last = retval;}
\DoxyCodeLine{343       \}}
\DoxyCodeLine{344       \textcolor{keywordflow}{else}}
\DoxyCodeLine{345       \{}
\DoxyCodeLine{346         \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}."{}});}
\DoxyCodeLine{347       \}}
\DoxyCodeLine{348       \textcolor{keywordflow}{break};}
\DoxyCodeLine{349     \}}
\DoxyCodeLine{350     delay(500);}
\DoxyCodeLine{351   \}}
\DoxyCodeLine{352 \}}
\DoxyCodeLine{353 }
\DoxyCodeLine{359 \textcolor{keywordtype}{int} \mbox{\hyperlink{_n_b___r410_m_8h_a155d2d05c4cd7202d2ccec3c482f5e90}{setAPN}}(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *apn)}
\DoxyCodeLine{360 \{}
\DoxyCodeLine{361   \textcolor{keywordtype}{int} result = 0;}
\DoxyCodeLine{362   \textcolor{keywordtype}{char} *command = NULL;}
\DoxyCodeLine{363   command = (\textcolor{keywordtype}{char} *)malloc(strlen(AT) + strlen(SARA\_SET\_APN) + strlen(apn) + 5);}
\DoxyCodeLine{364   \textcolor{keywordflow}{if} (command == NULL)}
\DoxyCodeLine{365   \{}
\DoxyCodeLine{366     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Malloc failed"{}});}
\DoxyCodeLine{367     \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{368   \}}
\DoxyCodeLine{369 }
\DoxyCodeLine{370   sprintf(command, \textcolor{stringliteral}{"{}\%s\%s\(\backslash\)"{}\%s\(\backslash\)"{}"{}}, AT, SARA\_SET\_APN, apn);}
\DoxyCodeLine{371   \mbox{\hyperlink{_n_b___r410_m_8h_a301d0294e9c5137ccbc922d3bf7831aa}{transmitCommand}}(command);}
\DoxyCodeLine{372   \textcolor{keywordflow}{if} (\mbox{\hyperlink{_n_b___r410_m_8h_a2540498d294eca76534a8015310df26d}{getResponse}}(\textcolor{stringliteral}{"{}OK"{}}, 1000))}
\DoxyCodeLine{373   \{}
\DoxyCodeLine{374     Serial.println(\textcolor{stringliteral}{"{}APN set"{}});}
\DoxyCodeLine{375     result = 0;}
\DoxyCodeLine{376   \}}
\DoxyCodeLine{377   \textcolor{keywordflow}{else}}
\DoxyCodeLine{378   \{}
\DoxyCodeLine{379     Serial.println(\textcolor{stringliteral}{"{}APN not set"{}});}
\DoxyCodeLine{380   \}}
\DoxyCodeLine{381   free(command);}
\DoxyCodeLine{382   \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{383 \}}
\DoxyCodeLine{384 }
\DoxyCodeLine{389 \textcolor{keywordtype}{char} *\mbox{\hyperlink{_n_b___r410_m_8h_a59fb44183e4857c7b1fa0db81abe59f2}{printInfo}}()}
\DoxyCodeLine{390 \{}
\DoxyCodeLine{391   \textcolor{keywordtype}{char} *ip = NULL;}
\DoxyCodeLine{392   \textcolor{keywordtype}{char} *command = NULL;}
\DoxyCodeLine{393   command = (\textcolor{keywordtype}{char} *)malloc(strlen(AT) + strlen(SARA\_NETWORK\_INFO\_GET) + 5);}
\DoxyCodeLine{394   ip = (\textcolor{keywordtype}{char} *)malloc(16);}
\DoxyCodeLine{395   \textcolor{keywordflow}{if} (ip == NULL)}
\DoxyCodeLine{396   \{}
\DoxyCodeLine{397     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Malloc failed"{}});}
\DoxyCodeLine{398     \textcolor{keywordflow}{return} NULL;}
\DoxyCodeLine{399   \}}
\DoxyCodeLine{400   \textcolor{keywordflow}{if} (command == NULL)}
\DoxyCodeLine{401   \{}
\DoxyCodeLine{402     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Malloc failed"{}});}
\DoxyCodeLine{403     \textcolor{keywordflow}{return} NULL;}
\DoxyCodeLine{404   \}}
\DoxyCodeLine{405   sprintf(command, \textcolor{stringliteral}{"{}\%s\%s"{}}, AT, SARA\_NETWORK\_INFO\_GET);}
\DoxyCodeLine{406   \mbox{\hyperlink{_n_b___r410_m_8h_a301d0294e9c5137ccbc922d3bf7831aa}{transmitCommand}}(command);}
\DoxyCodeLine{407 }
\DoxyCodeLine{408   \textcolor{keywordtype}{char} ret[128];}
\DoxyCodeLine{409   \textcolor{keywordtype}{int} destIndex = 0;}
\DoxyCodeLine{410   \textcolor{keywordtype}{int} index = 0;}
\DoxyCodeLine{411   \textcolor{keywordtype}{char} c;}
\DoxyCodeLine{412   \textcolor{keywordtype}{char} OK[] = \textcolor{stringliteral}{"{}OK"{}};}
\DoxyCodeLine{413   \textcolor{keywordtype}{int} size = 12;}
\DoxyCodeLine{414   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} timeIn = millis();}
\DoxyCodeLine{415   \textcolor{keywordflow}{while} (millis() -\/ timeIn < 1000)}
\DoxyCodeLine{416   \{}
\DoxyCodeLine{417     \textcolor{keywordflow}{if} (LTEShieldSerial.available())}
\DoxyCodeLine{418     \{}
\DoxyCodeLine{419       c = (char)LTEShieldSerial.read();}
\DoxyCodeLine{420       \textcolor{comment}{// Serial.print(c);}}
\DoxyCodeLine{421       ret[index] = c;}
\DoxyCodeLine{422       \textcolor{comment}{// printToConsole("{}index: \%d\(\backslash\)n"{}, index);}}
\DoxyCodeLine{423       \textcolor{keywordflow}{if} (ret[index -\/ 1] == OK[0] \&\& ret[index] == OK[1])}
\DoxyCodeLine{424       \{}
\DoxyCodeLine{425         \textcolor{keywordflow}{break};}
\DoxyCodeLine{426       \}}
\DoxyCodeLine{427       index++;}
\DoxyCodeLine{428     \}}
\DoxyCodeLine{429   \}}
\DoxyCodeLine{430   }
\DoxyCodeLine{431   ret[++index] = 0;}
\DoxyCodeLine{432   \textcolor{keywordtype}{char} * token = strtok(ret, \textcolor{stringliteral}{"{},\(\backslash\)"{}"{}});}
\DoxyCodeLine{433   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 3; i++)}
\DoxyCodeLine{434   \{}
\DoxyCodeLine{435     token = strtok(NULL, \textcolor{stringliteral}{"{}\(\backslash\)"{},\(\backslash\)"{}"{}});}
\DoxyCodeLine{436   \}}
\DoxyCodeLine{437   }
\DoxyCodeLine{438   strcpy(ip, token);}
\DoxyCodeLine{439   }
\DoxyCodeLine{440   \textcolor{keywordflow}{return} ip;}
\DoxyCodeLine{441 \}}
\DoxyCodeLine{442 }
\DoxyCodeLine{450 \textcolor{keywordtype}{int} \mbox{\hyperlink{_n_b___r410_m_8h_a1a2a52cca4c1a1964aa1bd6cb7ddd14b}{setCertMQTT}}(\textcolor{keyword}{const} \textcolor{keywordtype}{byte} *cert, \textcolor{keywordtype}{int} size, \textcolor{keywordtype}{int} type, \textcolor{keyword}{const} \textcolor{keywordtype}{char} *name)}
\DoxyCodeLine{451 \{}
\DoxyCodeLine{452   \textcolor{keywordtype}{int} result = 1;}
\DoxyCodeLine{453   \textcolor{keywordtype}{char} *command = NULL;}
\DoxyCodeLine{454   \textcolor{keywordtype}{char} *response = NULL;}
\DoxyCodeLine{455   response = (\textcolor{keywordtype}{char} *)malloc(strlen(SARA\_IMPORT\_CERT\_OK) + 5);}
\DoxyCodeLine{456   \textcolor{keywordflow}{if} (response == NULL)}
\DoxyCodeLine{457   \{}
\DoxyCodeLine{458     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Malloc failed\(\backslash\)n"{}});}
\DoxyCodeLine{459     \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{460   \}}
\DoxyCodeLine{461   command = (\textcolor{keywordtype}{char} *)malloc((strlen(AT) + strlen(SARA\_IMPORT\_CERT) + strlen(name) + 15));}
\DoxyCodeLine{462   \textcolor{keywordflow}{if} (command == NULL)}
\DoxyCodeLine{463   \{}
\DoxyCodeLine{464     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Malloc failed\(\backslash\)n"{}});}
\DoxyCodeLine{465     \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{466   \}}
\DoxyCodeLine{467   sprintf(command, \textcolor{stringliteral}{"{}\%s\%s\%d,\(\backslash\)"{}\%s\(\backslash\)"{},\%d"{}}, AT, SARA\_IMPORT\_CERT, type, name, size);}
\DoxyCodeLine{468   \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Importing certificate: "{}});}
\DoxyCodeLine{469   \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(name);}
\DoxyCodeLine{470   \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{471   \textcolor{comment}{// printToConsole("{}Command: \%s\(\backslash\)n"{}, command);}}
\DoxyCodeLine{472   \textcolor{comment}{//  Empties buffer and transmits the command}}
\DoxyCodeLine{473   \mbox{\hyperlink{_n_b___r410_m_8h_a301d0294e9c5137ccbc922d3bf7831aa}{transmitCommand}}(command);}
\DoxyCodeLine{474 }
\DoxyCodeLine{475   \textcolor{keywordflow}{if} (\mbox{\hyperlink{_n_b___r410_m_8h_a2540498d294eca76534a8015310df26d}{getResponse}}(SARA\_IMPORT\_CERT\_READY, 10000))}
\DoxyCodeLine{476   \{}
\DoxyCodeLine{477     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Ready to receive certificate:\(\backslash\)n"{}});}
\DoxyCodeLine{478     \textcolor{comment}{// printToConsole("{}\%s\(\backslash\)n"{},cert);}}
\DoxyCodeLine{479 }
\DoxyCodeLine{480     sprintf(response, \textcolor{stringliteral}{"{}\%s\%d"{}}, SARA\_IMPORT\_CERT\_OK, type);}
\DoxyCodeLine{481 }
\DoxyCodeLine{482     \textcolor{comment}{// Empties buffer and transmits the command}}
\DoxyCodeLine{483     \textcolor{comment}{//transmitCommand(cert);}}
\DoxyCodeLine{484     \textcolor{keywordflow}{while} (LTEShieldSerial.available())}
\DoxyCodeLine{485     \{}
\DoxyCodeLine{486       LTEShieldSerial.read();}
\DoxyCodeLine{487     \}}
\DoxyCodeLine{488     LTEShieldSerial.write(cert, size);}
\DoxyCodeLine{489 }
\DoxyCodeLine{490     \textcolor{keywordflow}{if} (\mbox{\hyperlink{_n_b___r410_m_8h_a2540498d294eca76534a8015310df26d}{getResponse}}(response, 10000))}
\DoxyCodeLine{491     \{}
\DoxyCodeLine{492       \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Certificate imported\(\backslash\)n"{}});}
\DoxyCodeLine{493       result = 0;}
\DoxyCodeLine{494     \}}
\DoxyCodeLine{495     \textcolor{keywordflow}{else}}
\DoxyCodeLine{496     \{}
\DoxyCodeLine{497       \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Certificate import failed\(\backslash\)n"{}});}
\DoxyCodeLine{498     \}}
\DoxyCodeLine{499   \}}
\DoxyCodeLine{500   \textcolor{keywordflow}{else}}
\DoxyCodeLine{501   \{}
\DoxyCodeLine{502     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Failed to import certificate -\/ not ready\(\backslash\)n"{}});}
\DoxyCodeLine{503   \}}
\DoxyCodeLine{504   free(command);}
\DoxyCodeLine{505   free(response);}
\DoxyCodeLine{506   \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{507 \}}
\DoxyCodeLine{508 }
\DoxyCodeLine{516 \textcolor{keywordtype}{int} \mbox{\hyperlink{_n_b___r410_m_8h_af2822bc89b1ea866056eb4683255223c}{loadCertMQTT}}(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *filename, \textcolor{keywordtype}{int} type, \textcolor{keyword}{const} \textcolor{keywordtype}{char} *name)}
\DoxyCodeLine{517 \{}
\DoxyCodeLine{518   \textcolor{keywordtype}{int} result = 0;}
\DoxyCodeLine{519   File certFile = SPIFFS.open(filename, \textcolor{stringliteral}{"{}r"{}});}
\DoxyCodeLine{520   \textcolor{keywordflow}{if} (!certFile)}
\DoxyCodeLine{521   \{}
\DoxyCodeLine{522     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Failed to open file for reading\(\backslash\)n"{}});}
\DoxyCodeLine{523     \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{524   \}}
\DoxyCodeLine{525   \textcolor{keywordtype}{int} size = certFile.size();}
\DoxyCodeLine{526   \textcolor{keywordtype}{byte} *cert = (\textcolor{keywordtype}{byte} *)malloc(size);}
\DoxyCodeLine{527   \textcolor{keywordflow}{if} (cert == NULL)}
\DoxyCodeLine{528   \{}
\DoxyCodeLine{529     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Malloc failed\(\backslash\)n"{}});}
\DoxyCodeLine{530     \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{531   \}}
\DoxyCodeLine{532   certFile.read(cert, size);}
\DoxyCodeLine{533   certFile.close();}
\DoxyCodeLine{534   result = \mbox{\hyperlink{_n_b___r410_m_8h_a1a2a52cca4c1a1964aa1bd6cb7ddd14b}{setCertMQTT}}(cert, size, type, name);}
\DoxyCodeLine{535   free(cert);}
\DoxyCodeLine{536   \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{537 \}}
\DoxyCodeLine{538 }
\DoxyCodeLine{544 \textcolor{keywordtype}{int} \mbox{\hyperlink{_n_b___r410_m_8h_a8c739d69e197ff1a6d151e981a268641}{setMQTTping}}(\textcolor{keywordtype}{int} timeout)}
\DoxyCodeLine{545 \{}
\DoxyCodeLine{546   \textcolor{keywordtype}{int} result = 1;}
\DoxyCodeLine{547   \textcolor{keywordtype}{char} *command = NULL;}
\DoxyCodeLine{548 }
\DoxyCodeLine{549   command = (\textcolor{keywordtype}{char} *)malloc(strlen(AT) + strlen(SARA\_TIMEOUT) + 5);}
\DoxyCodeLine{550   \textcolor{keywordflow}{if} (command == NULL)}
\DoxyCodeLine{551   \{}
\DoxyCodeLine{552     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Malloc failed\(\backslash\)n"{}});}
\DoxyCodeLine{553     \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{554   \}}
\DoxyCodeLine{555   sprintf(command, \textcolor{stringliteral}{"{}\%s\%s\%d"{}}, AT, SARA\_TIMEOUT, timeout);}
\DoxyCodeLine{556 }
\DoxyCodeLine{557   \textcolor{comment}{// Empties buffer and transmits the command}}
\DoxyCodeLine{558   \mbox{\hyperlink{_n_b___r410_m_8h_a301d0294e9c5137ccbc922d3bf7831aa}{transmitCommand}}(command);}
\DoxyCodeLine{559 }
\DoxyCodeLine{560   \textcolor{comment}{// Wait for the response}}
\DoxyCodeLine{561   \textcolor{keywordflow}{if} (\mbox{\hyperlink{_n_b___r410_m_8h_a2540498d294eca76534a8015310df26d}{getResponse}}(SARA\_TIMEOUT\_SET\_RESPONSE, 10000))}
\DoxyCodeLine{562   \{}
\DoxyCodeLine{563     \textcolor{keywordtype}{char} msgToPrint[50];}
\DoxyCodeLine{564     sprintf(msgToPrint, \textcolor{stringliteral}{"{}MQTT ping interval set to \%d seconds\(\backslash\)n"{}}, timeout);}
\DoxyCodeLine{565     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(msgToPrint);}
\DoxyCodeLine{566     result = 0;}
\DoxyCodeLine{567   \}}
\DoxyCodeLine{568   \textcolor{keywordflow}{else}}
\DoxyCodeLine{569   \{}
\DoxyCodeLine{570     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Error setting MQTT ping timeout\(\backslash\)n"{}});}
\DoxyCodeLine{571   \}}
\DoxyCodeLine{572   free(command);}
\DoxyCodeLine{573   \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{574 \}}
\DoxyCodeLine{575 }
\DoxyCodeLine{580 \textcolor{keywordtype}{int} \mbox{\hyperlink{_n_b___r410_m_8h_ae3585e6376929a7f5de0b8243b313e98}{enableMQTTkeepalive}}()}
\DoxyCodeLine{581 \{}
\DoxyCodeLine{582   \textcolor{keywordtype}{int} result = 1;}
\DoxyCodeLine{583   \textcolor{keywordtype}{char} *command = NULL;}
\DoxyCodeLine{584 }
\DoxyCodeLine{585   command = (\textcolor{keywordtype}{char} *)malloc(strlen(AT) + strlen(SARA\_PING) + 5);}
\DoxyCodeLine{586   \textcolor{keywordflow}{if} (command == NULL)}
\DoxyCodeLine{587   \{}
\DoxyCodeLine{588     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Malloc failed\(\backslash\)n"{}});}
\DoxyCodeLine{589     \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{590   \}}
\DoxyCodeLine{591   sprintf(command, \textcolor{stringliteral}{"{}\%s\%s"{}}, AT, SARA\_PING);}
\DoxyCodeLine{592 }
\DoxyCodeLine{593   \textcolor{comment}{// Empties buffer and transmits the command}}
\DoxyCodeLine{594   \mbox{\hyperlink{_n_b___r410_m_8h_a301d0294e9c5137ccbc922d3bf7831aa}{transmitCommand}}(command);}
\DoxyCodeLine{595 }
\DoxyCodeLine{596   \textcolor{comment}{// Wait for the response}}
\DoxyCodeLine{597   \textcolor{keywordflow}{if} (\mbox{\hyperlink{_n_b___r410_m_8h_a2540498d294eca76534a8015310df26d}{getResponse}}(SARA\_PING\_OK, 10000))}
\DoxyCodeLine{598   \{}
\DoxyCodeLine{599     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}MQTT keepalive enabled\(\backslash\)n"{}});}
\DoxyCodeLine{600     result = 0;}
\DoxyCodeLine{601   \}}
\DoxyCodeLine{602   \textcolor{keywordflow}{else}}
\DoxyCodeLine{603   \{}
\DoxyCodeLine{604     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Error enabling MQTT keepalive\(\backslash\)n"{}});}
\DoxyCodeLine{605   \}}
\DoxyCodeLine{606   free(command);}
\DoxyCodeLine{607   \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{608 \}}
\DoxyCodeLine{609 }
\DoxyCodeLine{618 \textcolor{keywordtype}{int} \mbox{\hyperlink{_n_b___r410_m_8h_a92d55d9f690d1e2c337f035700ef5a4e}{publishMessage}}(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *topic, \textcolor{keyword}{const} \textcolor{keywordtype}{char} *message, \textcolor{keywordtype}{int} QoS, \textcolor{keywordtype}{int} retain)}
\DoxyCodeLine{619 \{}
\DoxyCodeLine{620   \textcolor{keywordtype}{int} result = 1;}
\DoxyCodeLine{621   \textcolor{keywordtype}{char} *command = NULL;}
\DoxyCodeLine{622 }
\DoxyCodeLine{623   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} SARA\_SEND\_TIMEOUT = 60000;}
\DoxyCodeLine{624 }
\DoxyCodeLine{625   \textcolor{comment}{// printToConsole("{}Allocating memory for command\(\backslash\)n"{});}}
\DoxyCodeLine{626   command = (\textcolor{keywordtype}{char} *)malloc(strlen(AT) + strlen(SARA\_SEND\_MQTT) + strlen(message) + strlen(topic) + 8);}
\DoxyCodeLine{627   \textcolor{keywordflow}{if} (command == NULL)}
\DoxyCodeLine{628   \{}
\DoxyCodeLine{629     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Memory allocation failed\(\backslash\)n"{}});}
\DoxyCodeLine{630     \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{631   \}}
\DoxyCodeLine{632   \textcolor{comment}{// printToConsole("{}Building command\(\backslash\)n"{});}}
\DoxyCodeLine{633   sprintf(command, \textcolor{stringliteral}{"{}\%s\%s,\%d,\%d,\%s,\%s"{}}, AT, SARA\_SEND\_MQTT, QoS, retain, topic, message);}
\DoxyCodeLine{634 }
\DoxyCodeLine{635   \textcolor{comment}{// printToConsole("{}Command built....Sending\(\backslash\)n"{});}}
\DoxyCodeLine{636 }
\DoxyCodeLine{637   \textcolor{comment}{// Empties buffer and transmits the command}}
\DoxyCodeLine{638   \mbox{\hyperlink{_n_b___r410_m_8h_a301d0294e9c5137ccbc922d3bf7831aa}{transmitCommand}}(command);}
\DoxyCodeLine{639 }
\DoxyCodeLine{640   \textcolor{comment}{// printToConsole("{}Command sent....Waiting for response\(\backslash\)n"{});}}
\DoxyCodeLine{641   \textcolor{keywordflow}{if} (\mbox{\hyperlink{_n_b___r410_m_8h_a2540498d294eca76534a8015310df26d}{getResponse}}(SARA\_SEND\_OK, SARA\_SEND\_TIMEOUT))}
\DoxyCodeLine{642   \{}
\DoxyCodeLine{643     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Message sent\(\backslash\)n"{}});}
\DoxyCodeLine{644     result = 0;}
\DoxyCodeLine{645   \}}
\DoxyCodeLine{646   \textcolor{keywordflow}{else}}
\DoxyCodeLine{647   \{}
\DoxyCodeLine{648     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Error sending message\(\backslash\)n"{}});}
\DoxyCodeLine{649   \}}
\DoxyCodeLine{650 }
\DoxyCodeLine{651   free(command);}
\DoxyCodeLine{652   \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{653 \}}
\DoxyCodeLine{654 }
\DoxyCodeLine{659 \textcolor{keywordtype}{int} \mbox{\hyperlink{_n_b___r410_m_8h_ae0c1031eb25784bc3a5ab60e8f3981bf}{loginMQTT}}()}
\DoxyCodeLine{660 \{}
\DoxyCodeLine{661   \textcolor{keywordtype}{int} result = 1;}
\DoxyCodeLine{662   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} SARA\_IP\_CONNECT\_TIMEOUT = 60000;}
\DoxyCodeLine{663 }
\DoxyCodeLine{664   \textcolor{comment}{// Empties buffer and transmits the command}}
\DoxyCodeLine{665   \mbox{\hyperlink{_n_b___r410_m_8h_a301d0294e9c5137ccbc922d3bf7831aa}{transmitCommand}}(SARA\_LOGIN);}
\DoxyCodeLine{666 }
\DoxyCodeLine{667   \textcolor{keywordflow}{if} (\mbox{\hyperlink{_n_b___r410_m_8h_a2540498d294eca76534a8015310df26d}{getResponse}}(SARA\_LOGIN\_OK, SARA\_IP\_CONNECT\_TIMEOUT))}
\DoxyCodeLine{668   \{}
\DoxyCodeLine{669     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}MQTT login successfull\(\backslash\)n"{}});}
\DoxyCodeLine{670     result = 0;}
\DoxyCodeLine{671   \}}
\DoxyCodeLine{672   \textcolor{keywordflow}{else}}
\DoxyCodeLine{673   \{}
\DoxyCodeLine{674     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Error logging in to MQTT\(\backslash\)n"{}});}
\DoxyCodeLine{675   \}}
\DoxyCodeLine{676   \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{677 \}}
\DoxyCodeLine{678 }
\DoxyCodeLine{684 \textcolor{keywordtype}{int} \mbox{\hyperlink{_n_b___r410_m_8h_a05ff32195e69fc3d74b5bcd78781c5df}{willconfigMQTT}}(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *topic)}
\DoxyCodeLine{685 \{}
\DoxyCodeLine{686   \textcolor{keywordtype}{int} result = 1;}
\DoxyCodeLine{687   \textcolor{keywordtype}{char} *command = NULL;}
\DoxyCodeLine{688   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} SARA\_IP\_CONNECT\_TIMEOUT = 10000;}
\DoxyCodeLine{689 }
\DoxyCodeLine{690   command = (\textcolor{keywordtype}{char} *)malloc(strlen(AT) + strlen(SARA\_WILL\_TOPIC\_MQTT) + strlen(topic) + 10);}
\DoxyCodeLine{691   \textcolor{keywordflow}{if} (command == NULL)}
\DoxyCodeLine{692   \{}
\DoxyCodeLine{693     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Malloc failed"{}});}
\DoxyCodeLine{694     \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{695   \}}
\DoxyCodeLine{696   sprintf(command, \textcolor{stringliteral}{"{}\%s\%s\%d,\%d,\(\backslash\)"{}\%s\(\backslash\)"{}"{}}, AT, SARA\_WILL\_TOPIC\_MQTT, 0, 0, topic);}
\DoxyCodeLine{697 }
\DoxyCodeLine{698   \textcolor{comment}{// Empties buffer and transmits the command}}
\DoxyCodeLine{699   \mbox{\hyperlink{_n_b___r410_m_8h_a301d0294e9c5137ccbc922d3bf7831aa}{transmitCommand}}(command);}
\DoxyCodeLine{700 }
\DoxyCodeLine{701   \textcolor{keywordflow}{if} (\mbox{\hyperlink{_n_b___r410_m_8h_a2540498d294eca76534a8015310df26d}{getResponse}}(SARA\_TOPIC\_OK, SARA\_IP\_CONNECT\_TIMEOUT))}
\DoxyCodeLine{702   \{}
\DoxyCodeLine{703     Serial.println(\textcolor{stringliteral}{"{}Will topic set\(\backslash\)n"{}});}
\DoxyCodeLine{704     result = 0;}
\DoxyCodeLine{705   \}}
\DoxyCodeLine{706   \textcolor{keywordflow}{else}}
\DoxyCodeLine{707   \{}
\DoxyCodeLine{708     Serial.println(\textcolor{stringliteral}{"{}Will topic not set\(\backslash\)n"{}});}
\DoxyCodeLine{709   \}}
\DoxyCodeLine{710 }
\DoxyCodeLine{711   free(command);}
\DoxyCodeLine{712 }
\DoxyCodeLine{713   \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{714 \}}
\DoxyCodeLine{715 }
\DoxyCodeLine{721 \textcolor{keywordtype}{int} \mbox{\hyperlink{_n_b___r410_m_8h_adad4ab35b4d191aaed39087329867277}{willmsgMQTT}}(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *message)}
\DoxyCodeLine{722 \{}
\DoxyCodeLine{723   \textcolor{keywordtype}{int} result = 1;}
\DoxyCodeLine{724   \textcolor{keywordtype}{char} *command = NULL;}
\DoxyCodeLine{725 }
\DoxyCodeLine{726   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} SARA\_IP\_CONNECT\_TIMEOUT = 10000;}
\DoxyCodeLine{727 }
\DoxyCodeLine{728   command = (\textcolor{keywordtype}{char} *)malloc(strlen(AT) + strlen(SARA\_WILL\_MESSAGE\_MQTT) + strlen(message) + 10);}
\DoxyCodeLine{729   \textcolor{keywordflow}{if} (command == NULL)}
\DoxyCodeLine{730   \{}
\DoxyCodeLine{731     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Malloc failed\(\backslash\)n"{}});}
\DoxyCodeLine{732     \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{733   \}}
\DoxyCodeLine{734   sprintf(command, \textcolor{stringliteral}{"{}\%s\%s\(\backslash\)"{}\%s\(\backslash\)"{}"{}}, AT, SARA\_WILL\_MESSAGE\_MQTT, message);}
\DoxyCodeLine{735 }
\DoxyCodeLine{736   \textcolor{comment}{// Empties buffer and transmits the command}}
\DoxyCodeLine{737   \mbox{\hyperlink{_n_b___r410_m_8h_a301d0294e9c5137ccbc922d3bf7831aa}{transmitCommand}}(command);}
\DoxyCodeLine{738 }
\DoxyCodeLine{739   \textcolor{keywordflow}{if} (\mbox{\hyperlink{_n_b___r410_m_8h_a2540498d294eca76534a8015310df26d}{getResponse}}(SARA\_MESSAGE\_OK, SARA\_IP\_CONNECT\_TIMEOUT))}
\DoxyCodeLine{740   \{}
\DoxyCodeLine{741     Serial.println(\textcolor{stringliteral}{"{}Will message set\(\backslash\)n"{}});}
\DoxyCodeLine{742     result = 0;}
\DoxyCodeLine{743   \}}
\DoxyCodeLine{744   \textcolor{keywordflow}{else}}
\DoxyCodeLine{745   \{}
\DoxyCodeLine{746     Serial.println(\textcolor{stringliteral}{"{}Will message not set\(\backslash\)n"{}});}
\DoxyCodeLine{747   \}}
\DoxyCodeLine{748   free(command);}
\DoxyCodeLine{749   \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{750 \}}
\DoxyCodeLine{751 }
\DoxyCodeLine{758 \textcolor{keywordtype}{int} \mbox{\hyperlink{_n_b___r410_m_8h_ac0f44c06684338d6571b119289066fce}{setMQTT}}(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *host, \textcolor{keywordtype}{int} port)}
\DoxyCodeLine{759 \{}
\DoxyCodeLine{760   \textcolor{keywordtype}{int} result = 1;}
\DoxyCodeLine{761   \textcolor{keywordtype}{char} *command = NULL;}
\DoxyCodeLine{762   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} SARA\_IP\_CONNECT\_TIMEOUT = 10000;}
\DoxyCodeLine{763 }
\DoxyCodeLine{764   command = (\textcolor{keywordtype}{char} *)malloc(\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{char}) * (strlen(SARA\_CONNECT\_MQTT) + strlen(host) + 15));}
\DoxyCodeLine{765   \textcolor{keywordflow}{if} (command == NULL)}
\DoxyCodeLine{766   \{}
\DoxyCodeLine{767     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Malloc failed\(\backslash\)n"{}});}
\DoxyCodeLine{768     \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{769   \}}
\DoxyCodeLine{770   \textcolor{comment}{// Create the command}}
\DoxyCodeLine{771   sprintf(command, \textcolor{stringliteral}{"{}AT\%s=\%d,\(\backslash\)"{}\%s\(\backslash\)"{},\%d"{}}, SARA\_CONNECT\_MQTT, 2, host, port);}
\DoxyCodeLine{772   \textcolor{comment}{// Send the command}}
\DoxyCodeLine{773   \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Setting MQTT hostname \& port\(\backslash\)n"{}});}
\DoxyCodeLine{774 }
\DoxyCodeLine{775   \textcolor{comment}{// Empties buffer and transmits the command}}
\DoxyCodeLine{776   \mbox{\hyperlink{_n_b___r410_m_8h_a301d0294e9c5137ccbc922d3bf7831aa}{transmitCommand}}(command);}
\DoxyCodeLine{777 }
\DoxyCodeLine{778   \textcolor{comment}{// Wait for the response}}
\DoxyCodeLine{779   \textcolor{keywordflow}{if} (\mbox{\hyperlink{_n_b___r410_m_8h_a2540498d294eca76534a8015310df26d}{getResponse}}(SARA\_RESPONSE\_OK, SARA\_IP\_CONNECT\_TIMEOUT))}
\DoxyCodeLine{780   \{}
\DoxyCodeLine{781     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}MQTT hostname \& port set\(\backslash\)n"{}});}
\DoxyCodeLine{782     result = 0;}
\DoxyCodeLine{783   \}}
\DoxyCodeLine{784   \textcolor{keywordflow}{else}}
\DoxyCodeLine{785   \{}
\DoxyCodeLine{786     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}MQTT hostname \& port not set\(\backslash\)n"{}});}
\DoxyCodeLine{787   \}}
\DoxyCodeLine{788 }
\DoxyCodeLine{789   free(command);}
\DoxyCodeLine{790   \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{791 \}}

\end{DoxyCode}
