\hypertarget{_n_b___r410_m_8h_source}{}\doxysection{NB\+\_\+\+R410\+M.\+h}
\label{_n_b___r410_m_8h_source}\index{src/NB\_R410M.h@{src/NB\_R410M.h}}
\mbox{\hyperlink{_n_b___r410_m_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 }
\DoxyCodeLine{28 \textcolor{preprocessor}{\#include <Arduino.h>}}
\DoxyCodeLine{29 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_a_t__commands_8h}{AT\_commands.h}}"{}}}
\DoxyCodeLine{30 \textcolor{preprocessor}{\#include <HardwareSerial.h>}}
\DoxyCodeLine{31 \textcolor{preprocessor}{\#include "{}SPIFFS.h"{}}}
\DoxyCodeLine{32 }
\DoxyCodeLine{33 HardwareSerial lteSerial(2);}
\DoxyCodeLine{34 }
\DoxyCodeLine{35 uint8\_t * CA = NULL;}
\DoxyCodeLine{36 uint8\_t * CERT = NULL;}
\DoxyCodeLine{37 uint8\_t * KEY = NULL;}
\DoxyCodeLine{38 \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} fileCA\_size;}
\DoxyCodeLine{39 \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} fileCERT\_size;}
\DoxyCodeLine{40 \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} fileKEY\_size;}
\DoxyCodeLine{41 }
\DoxyCodeLine{42 \textcolor{preprocessor}{\#define SerialMonitor Serial}}
\DoxyCodeLine{43 \textcolor{preprocessor}{\#define LTEShieldSerial lteSerial}}
\DoxyCodeLine{44 }
\DoxyCodeLine{49 \textcolor{keywordtype}{void} \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *text)}
\DoxyCodeLine{50 \{}
\DoxyCodeLine{51   SerialMonitor.print(text);}
\DoxyCodeLine{52 \}}
\DoxyCodeLine{53 }
\DoxyCodeLine{58 \textcolor{keywordtype}{void} \mbox{\hyperlink{_n_b___r410_m_8h_a301d0294e9c5137ccbc922d3bf7831aa}{transmitCommand}}(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *command)}
\DoxyCodeLine{59 \{}
\DoxyCodeLine{60   \textcolor{comment}{// printToConsole("{}Command: \%s\(\backslash\)n"{}, command);}}
\DoxyCodeLine{61   \textcolor{comment}{//  Empty the serial buffer}}
\DoxyCodeLine{62   \textcolor{keywordflow}{while} (LTEShieldSerial.available())}
\DoxyCodeLine{63   \{}
\DoxyCodeLine{64     LTEShieldSerial.read();}
\DoxyCodeLine{65   \}}
\DoxyCodeLine{66   \textcolor{comment}{// Transmit the command}}
\DoxyCodeLine{67   LTEShieldSerial.print(command);}
\DoxyCodeLine{68   LTEShieldSerial.print(\textcolor{stringliteral}{"{}\(\backslash\)r"{}});}
\DoxyCodeLine{69 \}}
\DoxyCodeLine{70 }
\DoxyCodeLine{76 \textcolor{keywordtype}{int} \mbox{\hyperlink{_n_b___r410_m_8h_a2540498d294eca76534a8015310df26d}{getResponse}}(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *response, \textcolor{keywordtype}{int} timeout)}
\DoxyCodeLine{77 \{}
\DoxyCodeLine{78   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} timeIn = millis();}
\DoxyCodeLine{79   \textcolor{keywordtype}{char} ret[128];}
\DoxyCodeLine{80   \textcolor{keywordtype}{int} destIndex = 0;}
\DoxyCodeLine{81   \textcolor{keywordtype}{int} index = 0;}
\DoxyCodeLine{82   \textcolor{keywordtype}{char} c;}
\DoxyCodeLine{83   \textcolor{keywordtype}{int} size = strlen(response);}
\DoxyCodeLine{84 }
\DoxyCodeLine{85   \textcolor{keywordflow}{while} (millis() -\/ timeIn < timeout)}
\DoxyCodeLine{86   \{}
\DoxyCodeLine{87     \textcolor{keywordflow}{if} (LTEShieldSerial.available())}
\DoxyCodeLine{88     \{}
\DoxyCodeLine{89       c = (char)LTEShieldSerial.read();}
\DoxyCodeLine{90       \textcolor{comment}{//Serial.print(c);}}
\DoxyCodeLine{91       ret[destIndex++] = c;}
\DoxyCodeLine{92 }
\DoxyCodeLine{93       \textcolor{keywordflow}{if} (c == response[index])}
\DoxyCodeLine{94       \{}
\DoxyCodeLine{95         index++;}
\DoxyCodeLine{96         \textcolor{keywordflow}{if} (index == size)}
\DoxyCodeLine{97         \{}
\DoxyCodeLine{98           \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{99         \}}
\DoxyCodeLine{100       \}}
\DoxyCodeLine{101       \textcolor{keywordflow}{else}}
\DoxyCodeLine{102       \{}
\DoxyCodeLine{103         index = 0;}
\DoxyCodeLine{104       \}}
\DoxyCodeLine{105     \}}
\DoxyCodeLine{106   \}}
\DoxyCodeLine{107   ret[destIndex] = \textcolor{charliteral}{'\(\backslash\)0'};}
\DoxyCodeLine{108   \textcolor{comment}{//Serial.println(ret);}}
\DoxyCodeLine{109   \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{110 \}}
\DoxyCodeLine{111 }
\DoxyCodeLine{117 \textcolor{keywordtype}{int} \mbox{\hyperlink{_n_b___r410_m_8h_a66f862d5c7d16623b90ccf294c1cf055}{initModule}}(\textcolor{keywordtype}{int} timeout)}
\DoxyCodeLine{118 \{}
\DoxyCodeLine{119   LTEShieldSerial.begin(9600);}
\DoxyCodeLine{120   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} startTime = millis();}
\DoxyCodeLine{121   }
\DoxyCodeLine{122   \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Transmitting AT\(\backslash\)n"{}});}
\DoxyCodeLine{123   \textcolor{keywordflow}{while} (!\mbox{\hyperlink{_n_b___r410_m_8h_a2540498d294eca76534a8015310df26d}{getResponse}}(\textcolor{stringliteral}{"{}OK"{}}, 500))}
\DoxyCodeLine{124   \{}
\DoxyCodeLine{125     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}."{}});}
\DoxyCodeLine{126     \mbox{\hyperlink{_n_b___r410_m_8h_a301d0294e9c5137ccbc922d3bf7831aa}{transmitCommand}}(\textcolor{stringliteral}{"{}AT"{}}); \textcolor{comment}{// Send AT command to enable the interface}}
\DoxyCodeLine{127     }
\DoxyCodeLine{128     \textcolor{keywordflow}{if} (millis() -\/ startTime > timeout)}
\DoxyCodeLine{129     \{}
\DoxyCodeLine{130       \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{131     \}}
\DoxyCodeLine{132   \}}
\DoxyCodeLine{133   \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Got OK\(\backslash\)n"{}});}
\DoxyCodeLine{134 }
\DoxyCodeLine{135   \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Disabling echo\(\backslash\)n"{}});}
\DoxyCodeLine{136   \mbox{\hyperlink{_n_b___r410_m_8h_a301d0294e9c5137ccbc922d3bf7831aa}{transmitCommand}}(\textcolor{stringliteral}{"{}ATE0"{}}); \textcolor{comment}{// Disable echo}}
\DoxyCodeLine{137   \textcolor{keywordflow}{if} (\mbox{\hyperlink{_n_b___r410_m_8h_a2540498d294eca76534a8015310df26d}{getResponse}}(\textcolor{stringliteral}{"{}OK"{}}, 200))}
\DoxyCodeLine{138   \{}
\DoxyCodeLine{139     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Echo disabled"{}});}
\DoxyCodeLine{140   \}}
\DoxyCodeLine{141   \textcolor{keywordflow}{else}}
\DoxyCodeLine{142   \{}
\DoxyCodeLine{143     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Echo not disabled"{}});}
\DoxyCodeLine{144   \}}
\DoxyCodeLine{145 }
\DoxyCodeLine{146   \mbox{\hyperlink{_n_b___r410_m_8h_a301d0294e9c5137ccbc922d3bf7831aa}{transmitCommand}}(\textcolor{stringliteral}{"{}AT+CTZU=1"{}}); \textcolor{comment}{// Enable automatic time zone update}}
\DoxyCodeLine{147   \textcolor{keywordflow}{if} (\mbox{\hyperlink{_n_b___r410_m_8h_a2540498d294eca76534a8015310df26d}{getResponse}}(\textcolor{stringliteral}{"{}OK"{}}, 5000))}
\DoxyCodeLine{148   \{}
\DoxyCodeLine{149     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Automatic time zone update enabled"{}});}
\DoxyCodeLine{150   \}}
\DoxyCodeLine{151   \textcolor{keywordflow}{else}}
\DoxyCodeLine{152   \{}
\DoxyCodeLine{153     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Automatic time zone update not enabled"{}});}
\DoxyCodeLine{154   \}}
\DoxyCodeLine{155   \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{156 \}}
\DoxyCodeLine{162 \textcolor{keywordtype}{int} \mbox{\hyperlink{_n_b___r410_m_8h_a45ea19fd14a7f7c3d7803940c809dec8}{enableSSL}}(\textcolor{keywordtype}{int} profile)}
\DoxyCodeLine{163 \{}
\DoxyCodeLine{164   \textcolor{keywordtype}{char} *command = NULL;}
\DoxyCodeLine{165   command = (\textcolor{keywordtype}{char} *)malloc(strlen(AT) + strlen(SARA\_MQTT\_SECURE) + 5);}
\DoxyCodeLine{166   \textcolor{keywordflow}{if} (command == NULL)}
\DoxyCodeLine{167   \{}
\DoxyCodeLine{168     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Malloc failed"{}});}
\DoxyCodeLine{169     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{170   \}}
\DoxyCodeLine{171 }
\DoxyCodeLine{172   sprintf(command, \textcolor{stringliteral}{"{}\%s\%s\%d"{}}, AT, SARA\_MQTT\_SECURE, profile);}
\DoxyCodeLine{173   \mbox{\hyperlink{_n_b___r410_m_8h_a301d0294e9c5137ccbc922d3bf7831aa}{transmitCommand}}(command);}
\DoxyCodeLine{174   \textcolor{keywordflow}{if} (\mbox{\hyperlink{_n_b___r410_m_8h_a2540498d294eca76534a8015310df26d}{getResponse}}(SARA\_MQTT\_SECURE\_SET\_RESPONSE, 5000))}
\DoxyCodeLine{175   \{}
\DoxyCodeLine{176     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}SSL enabled"{}});}
\DoxyCodeLine{177     \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{178   \}}
\DoxyCodeLine{179   \textcolor{keywordflow}{else}}
\DoxyCodeLine{180   \{}
\DoxyCodeLine{181     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}SSL not enabled"{}});}
\DoxyCodeLine{182     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{183   \}}
\DoxyCodeLine{184 \}}
\DoxyCodeLine{185 }
\DoxyCodeLine{189 \textcolor{keywordtype}{void} \mbox{\hyperlink{_n_b___r410_m_8h_aa6f75e9b70b0ada28fb438225a155bbb}{getNetwork}}()}
\DoxyCodeLine{190 \{}
\DoxyCodeLine{191   \textcolor{keywordtype}{int} retval;}
\DoxyCodeLine{192   \textcolor{keywordtype}{int} last = 99;}
\DoxyCodeLine{193   \textcolor{keywordflow}{while} (retval != 1)}
\DoxyCodeLine{194   \{}
\DoxyCodeLine{195 }
\DoxyCodeLine{196     \textcolor{comment}{// Empty the serial buffer}}
\DoxyCodeLine{197     \textcolor{keywordflow}{while} (LTEShieldSerial.available())}
\DoxyCodeLine{198     \{}
\DoxyCodeLine{199       LTEShieldSerial.read();}
\DoxyCodeLine{200     \}}
\DoxyCodeLine{201     \mbox{\hyperlink{_n_b___r410_m_8h_a301d0294e9c5137ccbc922d3bf7831aa}{transmitCommand}}(\textcolor{stringliteral}{"{}AT+CEREG?"{}});}
\DoxyCodeLine{202     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} timeIn = millis();}
\DoxyCodeLine{203     \textcolor{keywordtype}{char} ret[128];}
\DoxyCodeLine{204     \textcolor{keywordtype}{int} destIndex = 0;}
\DoxyCodeLine{205     \textcolor{keywordtype}{int} index = 0;}
\DoxyCodeLine{206     \textcolor{keywordtype}{char} c;}
\DoxyCodeLine{207     \textcolor{keywordtype}{int} size = 12;}
\DoxyCodeLine{208     retval = 4;}
\DoxyCodeLine{209 }
\DoxyCodeLine{210     \textcolor{keywordflow}{while} (millis() -\/ timeIn < 1000)}
\DoxyCodeLine{211     \{}
\DoxyCodeLine{212       \textcolor{keywordflow}{if} (LTEShieldSerial.available())}
\DoxyCodeLine{213       \{}
\DoxyCodeLine{214         c = (char)LTEShieldSerial.read();}
\DoxyCodeLine{215         \textcolor{comment}{// Serial.print(c);}}
\DoxyCodeLine{216         ret[index++] = c;}
\DoxyCodeLine{217         \textcolor{comment}{// printToConsole("{}index: \%d\(\backslash\)n"{}, index);}}
\DoxyCodeLine{218         \textcolor{keywordflow}{if} (index > size)}
\DoxyCodeLine{219         \{}
\DoxyCodeLine{220           \textcolor{keywordflow}{break};}
\DoxyCodeLine{221         \}}
\DoxyCodeLine{222       \}}
\DoxyCodeLine{223     \}}
\DoxyCodeLine{224     ret[++index] = 0;}
\DoxyCodeLine{225     \textcolor{comment}{// printToConsole("{}ret: \%s\(\backslash\)n"{}, ret);}}
\DoxyCodeLine{226     sscanf(ret, \textcolor{stringliteral}{"{} +CEREG: 0,\%d"{}}, \&retval);}
\DoxyCodeLine{227     \textcolor{keywordflow}{switch} (retval)}
\DoxyCodeLine{228     \{}
\DoxyCodeLine{229     \textcolor{keywordflow}{case} 0:}
\DoxyCodeLine{230       \textcolor{keywordflow}{if} (last != retval)}
\DoxyCodeLine{231       \{}
\DoxyCodeLine{232         \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Not registered, MT is not currently searching a new operator to register to\(\backslash\)n"{}});}
\DoxyCodeLine{233         last = retval;}
\DoxyCodeLine{234       \}}
\DoxyCodeLine{235       \textcolor{keywordflow}{else}}
\DoxyCodeLine{236       \{}
\DoxyCodeLine{237         \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}."{}});}
\DoxyCodeLine{238       \}}
\DoxyCodeLine{239       \textcolor{keywordflow}{break};}
\DoxyCodeLine{240     \textcolor{keywordflow}{case} 1:}
\DoxyCodeLine{241       \textcolor{keywordflow}{if} (last != retval)}
\DoxyCodeLine{242       \{}
\DoxyCodeLine{243         \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Registered, home network\(\backslash\)n"{}});}
\DoxyCodeLine{244         last = retval;}
\DoxyCodeLine{245       \}}
\DoxyCodeLine{246       \textcolor{keywordflow}{else}}
\DoxyCodeLine{247       \{}
\DoxyCodeLine{248         \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}."{}});}
\DoxyCodeLine{249       \}}
\DoxyCodeLine{250       \textcolor{keywordflow}{break};}
\DoxyCodeLine{251     \textcolor{keywordflow}{case} 2:}
\DoxyCodeLine{252       \textcolor{keywordflow}{if} (last != retval)}
\DoxyCodeLine{253       \{}
\DoxyCodeLine{254         \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Scanning for network\(\backslash\)n"{}});}
\DoxyCodeLine{255         last = retval;}
\DoxyCodeLine{256       \}}
\DoxyCodeLine{257       \textcolor{keywordflow}{else}}
\DoxyCodeLine{258       \{}
\DoxyCodeLine{259         \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}."{}});}
\DoxyCodeLine{260       \}}
\DoxyCodeLine{261       \textcolor{keywordflow}{break};}
\DoxyCodeLine{262     \textcolor{keywordflow}{case} 3:}
\DoxyCodeLine{263       \textcolor{keywordflow}{if} (last != retval)}
\DoxyCodeLine{264       \{}
\DoxyCodeLine{265         \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Registration denied\(\backslash\)n"{}});}
\DoxyCodeLine{266         last = retval;}
\DoxyCodeLine{267       \}}
\DoxyCodeLine{268       \textcolor{keywordflow}{else}}
\DoxyCodeLine{269       \{}
\DoxyCodeLine{270         \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}."{}});}
\DoxyCodeLine{271       \}}
\DoxyCodeLine{272       \textcolor{keywordflow}{break};}
\DoxyCodeLine{273     \textcolor{keywordflow}{case} 4:}
\DoxyCodeLine{274       \textcolor{keywordflow}{if} (last != retval)}
\DoxyCodeLine{275       \{}
\DoxyCodeLine{276         \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Unknown\(\backslash\)n"{}});}
\DoxyCodeLine{277         last = retval;}
\DoxyCodeLine{278       \}}
\DoxyCodeLine{279       \textcolor{keywordflow}{else}}
\DoxyCodeLine{280       \{}
\DoxyCodeLine{281         \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}."{}});}
\DoxyCodeLine{282       \}}
\DoxyCodeLine{283       \textcolor{keywordflow}{break};}
\DoxyCodeLine{284     \textcolor{keywordflow}{case} 5:}
\DoxyCodeLine{285       \textcolor{keywordflow}{if} (last != retval)}
\DoxyCodeLine{286       \{}
\DoxyCodeLine{287         \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Registered, roaming\(\backslash\)n"{}});}
\DoxyCodeLine{288         last = retval;}
\DoxyCodeLine{289       \}}
\DoxyCodeLine{290       \textcolor{keywordflow}{else}}
\DoxyCodeLine{291       \{}
\DoxyCodeLine{292         \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}."{}});}
\DoxyCodeLine{293       \}}
\DoxyCodeLine{294       \textcolor{keywordflow}{break};}
\DoxyCodeLine{295     \textcolor{keywordflow}{default}:}
\DoxyCodeLine{296       \textcolor{keywordflow}{if} (last != retval)}
\DoxyCodeLine{297       \{}
\DoxyCodeLine{298         \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Unknown\(\backslash\)n"{}});}
\DoxyCodeLine{299         last = retval;}
\DoxyCodeLine{300       \}}
\DoxyCodeLine{301       \textcolor{keywordflow}{else}}
\DoxyCodeLine{302       \{}
\DoxyCodeLine{303         \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}."{}});}
\DoxyCodeLine{304       \}}
\DoxyCodeLine{305       \textcolor{keywordflow}{break};}
\DoxyCodeLine{306     \}}
\DoxyCodeLine{307     delay(500);}
\DoxyCodeLine{308   \}}
\DoxyCodeLine{309 \}}
\DoxyCodeLine{310 }
\DoxyCodeLine{316 \textcolor{keywordtype}{int} \mbox{\hyperlink{_n_b___r410_m_8h_a155d2d05c4cd7202d2ccec3c482f5e90}{setAPN}}(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *apn)}
\DoxyCodeLine{317 \{}
\DoxyCodeLine{318   \textcolor{keywordtype}{int} result = 0;}
\DoxyCodeLine{319   \textcolor{keywordtype}{char} *command = NULL;}
\DoxyCodeLine{320   command = (\textcolor{keywordtype}{char} *)malloc(strlen(AT) + strlen(SARA\_SET\_APN) + strlen(apn) + 5);}
\DoxyCodeLine{321   \textcolor{keywordflow}{if} (command == NULL)}
\DoxyCodeLine{322   \{}
\DoxyCodeLine{323     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Malloc failed"{}});}
\DoxyCodeLine{324     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{325   \}}
\DoxyCodeLine{326 }
\DoxyCodeLine{327   sprintf(command, \textcolor{stringliteral}{"{}\%s\%s\(\backslash\)"{}\%s\(\backslash\)"{}"{}}, AT, SARA\_SET\_APN, apn);}
\DoxyCodeLine{328   \mbox{\hyperlink{_n_b___r410_m_8h_a301d0294e9c5137ccbc922d3bf7831aa}{transmitCommand}}(command);}
\DoxyCodeLine{329   \textcolor{keywordflow}{if} (\mbox{\hyperlink{_n_b___r410_m_8h_a2540498d294eca76534a8015310df26d}{getResponse}}(\textcolor{stringliteral}{"{}OK"{}}, 1000))}
\DoxyCodeLine{330   \{}
\DoxyCodeLine{331     Serial.println(\textcolor{stringliteral}{"{}APN set"{}});}
\DoxyCodeLine{332     result = 1;}
\DoxyCodeLine{333   \}}
\DoxyCodeLine{334   \textcolor{keywordflow}{else}}
\DoxyCodeLine{335   \{}
\DoxyCodeLine{336     Serial.println(\textcolor{stringliteral}{"{}APN not set"{}});}
\DoxyCodeLine{337   \}}
\DoxyCodeLine{338   free(command);}
\DoxyCodeLine{339   \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{340 \}}
\DoxyCodeLine{341 }
\DoxyCodeLine{346 \textcolor{keywordtype}{char} *\mbox{\hyperlink{_n_b___r410_m_8h_a59fb44183e4857c7b1fa0db81abe59f2}{printInfo}}()}
\DoxyCodeLine{347 \{}
\DoxyCodeLine{348   \textcolor{keywordtype}{char} *ip = NULL;}
\DoxyCodeLine{349   \textcolor{keywordtype}{char} *command = NULL;}
\DoxyCodeLine{350   command = (\textcolor{keywordtype}{char} *)malloc(strlen(AT) + strlen(SARA\_NETWORK\_INFO\_GET) + 5);}
\DoxyCodeLine{351   ip = (\textcolor{keywordtype}{char} *)malloc(16);}
\DoxyCodeLine{352   \textcolor{keywordflow}{if} (ip == NULL)}
\DoxyCodeLine{353   \{}
\DoxyCodeLine{354     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Malloc failed"{}});}
\DoxyCodeLine{355     \textcolor{keywordflow}{return} NULL;}
\DoxyCodeLine{356   \}}
\DoxyCodeLine{357   \textcolor{keywordflow}{if} (command == NULL)}
\DoxyCodeLine{358   \{}
\DoxyCodeLine{359     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Malloc failed"{}});}
\DoxyCodeLine{360     \textcolor{keywordflow}{return} NULL;}
\DoxyCodeLine{361   \}}
\DoxyCodeLine{362   sprintf(command, \textcolor{stringliteral}{"{}\%s\%s"{}}, AT, SARA\_NETWORK\_INFO\_GET);}
\DoxyCodeLine{363   \mbox{\hyperlink{_n_b___r410_m_8h_a301d0294e9c5137ccbc922d3bf7831aa}{transmitCommand}}(command);}
\DoxyCodeLine{364 }
\DoxyCodeLine{365   \textcolor{keywordtype}{char} ret[128];}
\DoxyCodeLine{366   \textcolor{keywordtype}{int} destIndex = 0;}
\DoxyCodeLine{367   \textcolor{keywordtype}{int} index = 0;}
\DoxyCodeLine{368   \textcolor{keywordtype}{char} c;}
\DoxyCodeLine{369   \textcolor{keywordtype}{char} OK[] = \textcolor{stringliteral}{"{}OK"{}};}
\DoxyCodeLine{370   \textcolor{keywordtype}{int} size = 12;}
\DoxyCodeLine{371   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} timeIn = millis();}
\DoxyCodeLine{372   \textcolor{keywordflow}{while} (millis() -\/ timeIn < 1000)}
\DoxyCodeLine{373   \{}
\DoxyCodeLine{374     \textcolor{keywordflow}{if} (LTEShieldSerial.available())}
\DoxyCodeLine{375     \{}
\DoxyCodeLine{376       c = (char)LTEShieldSerial.read();}
\DoxyCodeLine{377       \textcolor{comment}{// Serial.print(c);}}
\DoxyCodeLine{378       ret[index] = c;}
\DoxyCodeLine{379       \textcolor{comment}{// printToConsole("{}index: \%d\(\backslash\)n"{}, index);}}
\DoxyCodeLine{380       \textcolor{keywordflow}{if} (ret[index -\/ 1] == OK[0] \&\& ret[index] == OK[1])}
\DoxyCodeLine{381       \{}
\DoxyCodeLine{382         \textcolor{keywordflow}{break};}
\DoxyCodeLine{383       \}}
\DoxyCodeLine{384       index++;}
\DoxyCodeLine{385     \}}
\DoxyCodeLine{386   \}}
\DoxyCodeLine{387   }
\DoxyCodeLine{388   ret[++index] = 0;}
\DoxyCodeLine{389   \textcolor{keywordtype}{char} * token = strtok(ret, \textcolor{stringliteral}{"{},\(\backslash\)"{}"{}});}
\DoxyCodeLine{390   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 3; i++)}
\DoxyCodeLine{391   \{}
\DoxyCodeLine{392     token = strtok(NULL, \textcolor{stringliteral}{"{}\(\backslash\)"{},\(\backslash\)"{}"{}});}
\DoxyCodeLine{393   \}}
\DoxyCodeLine{394   }
\DoxyCodeLine{395   strcpy(ip, token);}
\DoxyCodeLine{396   }
\DoxyCodeLine{397   \textcolor{keywordflow}{return} ip;}
\DoxyCodeLine{398 \}}
\DoxyCodeLine{399 }
\DoxyCodeLine{407 \textcolor{keywordtype}{int} \mbox{\hyperlink{_n_b___r410_m_8h_a1a2a52cca4c1a1964aa1bd6cb7ddd14b}{setCertMQTT}}(\textcolor{keyword}{const} \textcolor{keywordtype}{byte} *cert, \textcolor{keywordtype}{int} size, \textcolor{keywordtype}{int} type, \textcolor{keyword}{const} \textcolor{keywordtype}{char} *name)}
\DoxyCodeLine{408 \{}
\DoxyCodeLine{409   \textcolor{keywordtype}{int} result = 0;}
\DoxyCodeLine{410   \textcolor{keywordtype}{char} *command = NULL;}
\DoxyCodeLine{411   \textcolor{keywordtype}{char} *response = NULL;}
\DoxyCodeLine{412   response = (\textcolor{keywordtype}{char} *)malloc(strlen(SARA\_IMPORT\_CERT\_OK) + 5);}
\DoxyCodeLine{413   \textcolor{keywordflow}{if} (response == NULL)}
\DoxyCodeLine{414   \{}
\DoxyCodeLine{415     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Malloc failed\(\backslash\)n"{}});}
\DoxyCodeLine{416     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{417   \}}
\DoxyCodeLine{418   command = (\textcolor{keywordtype}{char} *)malloc((strlen(AT) + strlen(SARA\_IMPORT\_CERT) + strlen(name) + 15));}
\DoxyCodeLine{419   \textcolor{keywordflow}{if} (command == NULL)}
\DoxyCodeLine{420   \{}
\DoxyCodeLine{421     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Malloc failed\(\backslash\)n"{}});}
\DoxyCodeLine{422     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{423   \}}
\DoxyCodeLine{424   sprintf(command, \textcolor{stringliteral}{"{}\%s\%s\%d,\(\backslash\)"{}\%s\(\backslash\)"{},\%d"{}}, AT, SARA\_IMPORT\_CERT, type, name, size);}
\DoxyCodeLine{425   \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Importing certificate: "{}});}
\DoxyCodeLine{426   \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(name);}
\DoxyCodeLine{427   \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{428   \textcolor{comment}{// printToConsole("{}Command: \%s\(\backslash\)n"{}, command);}}
\DoxyCodeLine{429   \textcolor{comment}{//  Empties buffer and transmits the command}}
\DoxyCodeLine{430   \mbox{\hyperlink{_n_b___r410_m_8h_a301d0294e9c5137ccbc922d3bf7831aa}{transmitCommand}}(command);}
\DoxyCodeLine{431 }
\DoxyCodeLine{432   \textcolor{keywordflow}{if} (\mbox{\hyperlink{_n_b___r410_m_8h_a2540498d294eca76534a8015310df26d}{getResponse}}(SARA\_IMPORT\_CERT\_READY, 10000))}
\DoxyCodeLine{433   \{}
\DoxyCodeLine{434     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Ready to receive certificate:\(\backslash\)n"{}});}
\DoxyCodeLine{435     \textcolor{comment}{// printToConsole("{}\%s\(\backslash\)n"{},cert);}}
\DoxyCodeLine{436 }
\DoxyCodeLine{437     sprintf(response, \textcolor{stringliteral}{"{}\%s\%d"{}}, SARA\_IMPORT\_CERT\_OK, type);}
\DoxyCodeLine{438 }
\DoxyCodeLine{439     \textcolor{comment}{// Empties buffer and transmits the command}}
\DoxyCodeLine{440     \textcolor{comment}{//transmitCommand(cert);}}
\DoxyCodeLine{441     \textcolor{keywordflow}{while} (LTEShieldSerial.available())}
\DoxyCodeLine{442     \{}
\DoxyCodeLine{443       LTEShieldSerial.read();}
\DoxyCodeLine{444     \}}
\DoxyCodeLine{445     LTEShieldSerial.write(cert, size);}
\DoxyCodeLine{446 }
\DoxyCodeLine{447     \textcolor{keywordflow}{if} (\mbox{\hyperlink{_n_b___r410_m_8h_a2540498d294eca76534a8015310df26d}{getResponse}}(response, 10000))}
\DoxyCodeLine{448     \{}
\DoxyCodeLine{449       \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Certificate imported\(\backslash\)n"{}});}
\DoxyCodeLine{450       result = 1;}
\DoxyCodeLine{451     \}}
\DoxyCodeLine{452     \textcolor{keywordflow}{else}}
\DoxyCodeLine{453     \{}
\DoxyCodeLine{454       \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Certificate import failed\(\backslash\)n"{}});}
\DoxyCodeLine{455     \}}
\DoxyCodeLine{456   \}}
\DoxyCodeLine{457   \textcolor{keywordflow}{else}}
\DoxyCodeLine{458   \{}
\DoxyCodeLine{459     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Failed to import certificate -\/ not ready\(\backslash\)n"{}});}
\DoxyCodeLine{460   \}}
\DoxyCodeLine{461   free(command);}
\DoxyCodeLine{462   free(response);}
\DoxyCodeLine{463   \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{464 \}}
\DoxyCodeLine{465 }
\DoxyCodeLine{473 \textcolor{keywordtype}{int} \mbox{\hyperlink{_n_b___r410_m_8h_af2822bc89b1ea866056eb4683255223c}{loadCertMQTT}}(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *filename, \textcolor{keywordtype}{int} type, \textcolor{keyword}{const} \textcolor{keywordtype}{char} *name)}
\DoxyCodeLine{474 \{}
\DoxyCodeLine{475   \textcolor{keywordtype}{int} result = 0;}
\DoxyCodeLine{476   File certFile = SPIFFS.open(filename, \textcolor{stringliteral}{"{}r"{}});}
\DoxyCodeLine{477   \textcolor{keywordflow}{if} (!certFile)}
\DoxyCodeLine{478   \{}
\DoxyCodeLine{479     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Failed to open file for reading\(\backslash\)n"{}});}
\DoxyCodeLine{480     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{481   \}}
\DoxyCodeLine{482   \textcolor{keywordtype}{int} size = certFile.size();}
\DoxyCodeLine{483   \textcolor{keywordtype}{byte} *cert = (\textcolor{keywordtype}{byte} *)malloc(size);}
\DoxyCodeLine{484   \textcolor{keywordflow}{if} (cert == NULL)}
\DoxyCodeLine{485   \{}
\DoxyCodeLine{486     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Malloc failed\(\backslash\)n"{}});}
\DoxyCodeLine{487     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{488   \}}
\DoxyCodeLine{489   certFile.read(cert, size);}
\DoxyCodeLine{490   certFile.close();}
\DoxyCodeLine{491   result = \mbox{\hyperlink{_n_b___r410_m_8h_a1a2a52cca4c1a1964aa1bd6cb7ddd14b}{setCertMQTT}}(cert, size, type, name);}
\DoxyCodeLine{492   free(cert);}
\DoxyCodeLine{493   \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{494 \}}
\DoxyCodeLine{495 }
\DoxyCodeLine{501 \textcolor{keywordtype}{int} \mbox{\hyperlink{_n_b___r410_m_8h_a8c739d69e197ff1a6d151e981a268641}{setMQTTping}}(\textcolor{keywordtype}{int} timeout)}
\DoxyCodeLine{502 \{}
\DoxyCodeLine{503   \textcolor{keywordtype}{int} result = 0;}
\DoxyCodeLine{504   \textcolor{keywordtype}{char} *command = NULL;}
\DoxyCodeLine{505 }
\DoxyCodeLine{506   command = (\textcolor{keywordtype}{char} *)malloc(strlen(AT) + strlen(SARA\_TIMEOUT) + 5);}
\DoxyCodeLine{507   \textcolor{keywordflow}{if} (command == NULL)}
\DoxyCodeLine{508   \{}
\DoxyCodeLine{509     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Malloc failed\(\backslash\)n"{}});}
\DoxyCodeLine{510     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{511   \}}
\DoxyCodeLine{512   sprintf(command, \textcolor{stringliteral}{"{}\%s\%s\%d"{}}, AT, SARA\_TIMEOUT, timeout);}
\DoxyCodeLine{513 }
\DoxyCodeLine{514   \textcolor{comment}{// Empties buffer and transmits the command}}
\DoxyCodeLine{515   \mbox{\hyperlink{_n_b___r410_m_8h_a301d0294e9c5137ccbc922d3bf7831aa}{transmitCommand}}(command);}
\DoxyCodeLine{516 }
\DoxyCodeLine{517   \textcolor{comment}{// Wait for the response}}
\DoxyCodeLine{518   \textcolor{keywordflow}{if} (\mbox{\hyperlink{_n_b___r410_m_8h_a2540498d294eca76534a8015310df26d}{getResponse}}(SARA\_TIMEOUT\_SET\_RESPONSE, 10000))}
\DoxyCodeLine{519   \{}
\DoxyCodeLine{520     \textcolor{keywordtype}{char} msgToPrint[50];}
\DoxyCodeLine{521     sprintf(msgToPrint, \textcolor{stringliteral}{"{}MQTT ping interval set to \%d seconds\(\backslash\)n"{}}, timeout);}
\DoxyCodeLine{522     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(msgToPrint);}
\DoxyCodeLine{523     result = 1;}
\DoxyCodeLine{524   \}}
\DoxyCodeLine{525   \textcolor{keywordflow}{else}}
\DoxyCodeLine{526   \{}
\DoxyCodeLine{527     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Error setting MQTT ping timeout\(\backslash\)n"{}});}
\DoxyCodeLine{528   \}}
\DoxyCodeLine{529   free(command);}
\DoxyCodeLine{530   \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{531 \}}
\DoxyCodeLine{532 }
\DoxyCodeLine{537 \textcolor{keywordtype}{int} \mbox{\hyperlink{_n_b___r410_m_8h_ae3585e6376929a7f5de0b8243b313e98}{enableMQTTkeepalive}}()}
\DoxyCodeLine{538 \{}
\DoxyCodeLine{539   \textcolor{keywordtype}{int} result = 0;}
\DoxyCodeLine{540   \textcolor{keywordtype}{char} *command = NULL;}
\DoxyCodeLine{541 }
\DoxyCodeLine{542   command = (\textcolor{keywordtype}{char} *)malloc(strlen(AT) + strlen(SARA\_PING) + 5);}
\DoxyCodeLine{543   \textcolor{keywordflow}{if} (command == NULL)}
\DoxyCodeLine{544   \{}
\DoxyCodeLine{545     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Malloc failed\(\backslash\)n"{}});}
\DoxyCodeLine{546     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{547   \}}
\DoxyCodeLine{548   sprintf(command, \textcolor{stringliteral}{"{}\%s\%s"{}}, AT, SARA\_PING);}
\DoxyCodeLine{549 }
\DoxyCodeLine{550   \textcolor{comment}{// Empties buffer and transmits the command}}
\DoxyCodeLine{551   \mbox{\hyperlink{_n_b___r410_m_8h_a301d0294e9c5137ccbc922d3bf7831aa}{transmitCommand}}(command);}
\DoxyCodeLine{552 }
\DoxyCodeLine{553   \textcolor{comment}{// Wait for the response}}
\DoxyCodeLine{554   \textcolor{keywordflow}{if} (\mbox{\hyperlink{_n_b___r410_m_8h_a2540498d294eca76534a8015310df26d}{getResponse}}(SARA\_PING\_OK, 10000))}
\DoxyCodeLine{555   \{}
\DoxyCodeLine{556     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}MQTT keepalive enabled\(\backslash\)n"{}});}
\DoxyCodeLine{557     result = 1;}
\DoxyCodeLine{558   \}}
\DoxyCodeLine{559   \textcolor{keywordflow}{else}}
\DoxyCodeLine{560   \{}
\DoxyCodeLine{561     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Error enabling MQTT keepalive\(\backslash\)n"{}});}
\DoxyCodeLine{562   \}}
\DoxyCodeLine{563   free(command);}
\DoxyCodeLine{564   \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{565 \}}
\DoxyCodeLine{566 }
\DoxyCodeLine{575 \textcolor{keywordtype}{int} \mbox{\hyperlink{_n_b___r410_m_8h_a92d55d9f690d1e2c337f035700ef5a4e}{publishMessage}}(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *topic, \textcolor{keyword}{const} \textcolor{keywordtype}{char} *message, \textcolor{keywordtype}{int} QoS, \textcolor{keywordtype}{int} retain)}
\DoxyCodeLine{576 \{}
\DoxyCodeLine{577   \textcolor{keywordtype}{int} result = 0;}
\DoxyCodeLine{578   \textcolor{keywordtype}{char} *command = NULL;}
\DoxyCodeLine{579 }
\DoxyCodeLine{580   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} SARA\_SEND\_TIMEOUT = 60000;}
\DoxyCodeLine{581 }
\DoxyCodeLine{582   \textcolor{comment}{// printToConsole("{}Allocating memory for command\(\backslash\)n"{});}}
\DoxyCodeLine{583   command = (\textcolor{keywordtype}{char} *)malloc(strlen(AT) + strlen(SARA\_SEND\_MQTT) + strlen(message) + strlen(topic) + 8);}
\DoxyCodeLine{584   \textcolor{keywordflow}{if} (command == NULL)}
\DoxyCodeLine{585   \{}
\DoxyCodeLine{586     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Memory allocation failed\(\backslash\)n"{}});}
\DoxyCodeLine{587     \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{588   \}}
\DoxyCodeLine{589   \textcolor{comment}{// printToConsole("{}Building command\(\backslash\)n"{});}}
\DoxyCodeLine{590   sprintf(command, \textcolor{stringliteral}{"{}\%s\%s,\%d,\%d,\%s,\%s"{}}, AT, SARA\_SEND\_MQTT, QoS, retain, topic, message);}
\DoxyCodeLine{591 }
\DoxyCodeLine{592   \textcolor{comment}{// printToConsole("{}Command built....Sending\(\backslash\)n"{});}}
\DoxyCodeLine{593 }
\DoxyCodeLine{594   \textcolor{comment}{// Empties buffer and transmits the command}}
\DoxyCodeLine{595   \mbox{\hyperlink{_n_b___r410_m_8h_a301d0294e9c5137ccbc922d3bf7831aa}{transmitCommand}}(command);}
\DoxyCodeLine{596 }
\DoxyCodeLine{597   \textcolor{comment}{// printToConsole("{}Command sent....Waiting for response\(\backslash\)n"{});}}
\DoxyCodeLine{598   \textcolor{keywordflow}{if} (\mbox{\hyperlink{_n_b___r410_m_8h_a2540498d294eca76534a8015310df26d}{getResponse}}(SARA\_SEND\_OK, SARA\_SEND\_TIMEOUT))}
\DoxyCodeLine{599   \{}
\DoxyCodeLine{600     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Message sent\(\backslash\)n"{}});}
\DoxyCodeLine{601     result = 1;}
\DoxyCodeLine{602   \}}
\DoxyCodeLine{603   \textcolor{keywordflow}{else}}
\DoxyCodeLine{604   \{}
\DoxyCodeLine{605     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Error sending message\(\backslash\)n"{}});}
\DoxyCodeLine{606   \}}
\DoxyCodeLine{607 }
\DoxyCodeLine{608   free(command);}
\DoxyCodeLine{609   \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{610 \}}
\DoxyCodeLine{611 }
\DoxyCodeLine{616 \textcolor{keywordtype}{int} \mbox{\hyperlink{_n_b___r410_m_8h_ae0c1031eb25784bc3a5ab60e8f3981bf}{loginMQTT}}()}
\DoxyCodeLine{617 \{}
\DoxyCodeLine{618   \textcolor{keywordtype}{int} result = 0;}
\DoxyCodeLine{619   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} SARA\_IP\_CONNECT\_TIMEOUT = 60000;}
\DoxyCodeLine{620 }
\DoxyCodeLine{621   \textcolor{comment}{// Empties buffer and transmits the command}}
\DoxyCodeLine{622   \mbox{\hyperlink{_n_b___r410_m_8h_a301d0294e9c5137ccbc922d3bf7831aa}{transmitCommand}}(SARA\_LOGIN);}
\DoxyCodeLine{623 }
\DoxyCodeLine{624   \textcolor{keywordflow}{if} (\mbox{\hyperlink{_n_b___r410_m_8h_a2540498d294eca76534a8015310df26d}{getResponse}}(SARA\_LOGIN\_OK, SARA\_IP\_CONNECT\_TIMEOUT))}
\DoxyCodeLine{625   \{}
\DoxyCodeLine{626     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}MQTT login successfull\(\backslash\)n"{}});}
\DoxyCodeLine{627     result = 1;}
\DoxyCodeLine{628   \}}
\DoxyCodeLine{629   \textcolor{keywordflow}{else}}
\DoxyCodeLine{630   \{}
\DoxyCodeLine{631     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Error logging in to MQTT\(\backslash\)n"{}});}
\DoxyCodeLine{632   \}}
\DoxyCodeLine{633   \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{634 \}}
\DoxyCodeLine{635 }
\DoxyCodeLine{641 \textcolor{keywordtype}{int} \mbox{\hyperlink{_n_b___r410_m_8h_a05ff32195e69fc3d74b5bcd78781c5df}{willconfigMQTT}}(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *topic)}
\DoxyCodeLine{642 \{}
\DoxyCodeLine{643   \textcolor{keywordtype}{int} result = 0;}
\DoxyCodeLine{644   \textcolor{keywordtype}{char} *command = NULL;}
\DoxyCodeLine{645   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} SARA\_IP\_CONNECT\_TIMEOUT = 10000;}
\DoxyCodeLine{646 }
\DoxyCodeLine{647   command = (\textcolor{keywordtype}{char} *)malloc(strlen(AT) + strlen(SARA\_WILL\_TOPIC\_MQTT) + strlen(topic) + 10);}
\DoxyCodeLine{648   \textcolor{keywordflow}{if} (command == NULL)}
\DoxyCodeLine{649   \{}
\DoxyCodeLine{650     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Malloc failed"{}});}
\DoxyCodeLine{651     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{652   \}}
\DoxyCodeLine{653   sprintf(command, \textcolor{stringliteral}{"{}\%s\%s\%d,\%d,\(\backslash\)"{}\%s\(\backslash\)"{}"{}}, AT, SARA\_WILL\_TOPIC\_MQTT, 0, 0, topic);}
\DoxyCodeLine{654 }
\DoxyCodeLine{655   \textcolor{comment}{// Empties buffer and transmits the command}}
\DoxyCodeLine{656   \mbox{\hyperlink{_n_b___r410_m_8h_a301d0294e9c5137ccbc922d3bf7831aa}{transmitCommand}}(command);}
\DoxyCodeLine{657 }
\DoxyCodeLine{658   \textcolor{keywordflow}{if} (\mbox{\hyperlink{_n_b___r410_m_8h_a2540498d294eca76534a8015310df26d}{getResponse}}(SARA\_TOPIC\_OK, SARA\_IP\_CONNECT\_TIMEOUT))}
\DoxyCodeLine{659   \{}
\DoxyCodeLine{660     Serial.println(\textcolor{stringliteral}{"{}Will topic set\(\backslash\)n"{}});}
\DoxyCodeLine{661     result = 1;}
\DoxyCodeLine{662   \}}
\DoxyCodeLine{663   \textcolor{keywordflow}{else}}
\DoxyCodeLine{664   \{}
\DoxyCodeLine{665     Serial.println(\textcolor{stringliteral}{"{}Will topic not set\(\backslash\)n"{}});}
\DoxyCodeLine{666   \}}
\DoxyCodeLine{667 }
\DoxyCodeLine{668   free(command);}
\DoxyCodeLine{669 }
\DoxyCodeLine{670   \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{671 \}}
\DoxyCodeLine{672 }
\DoxyCodeLine{678 \textcolor{keywordtype}{int} \mbox{\hyperlink{_n_b___r410_m_8h_adad4ab35b4d191aaed39087329867277}{willmsgMQTT}}(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *message)}
\DoxyCodeLine{679 \{}
\DoxyCodeLine{680   \textcolor{keywordtype}{int} result = 0;}
\DoxyCodeLine{681   \textcolor{keywordtype}{char} *command = NULL;}
\DoxyCodeLine{682 }
\DoxyCodeLine{683   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} SARA\_IP\_CONNECT\_TIMEOUT = 10000;}
\DoxyCodeLine{684 }
\DoxyCodeLine{685   command = (\textcolor{keywordtype}{char} *)malloc(strlen(AT) + strlen(SARA\_WILL\_MESSAGE\_MQTT) + strlen(message) + 10);}
\DoxyCodeLine{686   \textcolor{keywordflow}{if} (command == NULL)}
\DoxyCodeLine{687   \{}
\DoxyCodeLine{688     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Malloc failed\(\backslash\)n"{}});}
\DoxyCodeLine{689     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{690   \}}
\DoxyCodeLine{691   sprintf(command, \textcolor{stringliteral}{"{}\%s\%s\(\backslash\)"{}\%s\(\backslash\)"{}"{}}, AT, SARA\_WILL\_MESSAGE\_MQTT, message);}
\DoxyCodeLine{692 }
\DoxyCodeLine{693   \textcolor{comment}{// Empties buffer and transmits the command}}
\DoxyCodeLine{694   \mbox{\hyperlink{_n_b___r410_m_8h_a301d0294e9c5137ccbc922d3bf7831aa}{transmitCommand}}(command);}
\DoxyCodeLine{695 }
\DoxyCodeLine{696   \textcolor{keywordflow}{if} (\mbox{\hyperlink{_n_b___r410_m_8h_a2540498d294eca76534a8015310df26d}{getResponse}}(SARA\_MESSAGE\_OK, SARA\_IP\_CONNECT\_TIMEOUT))}
\DoxyCodeLine{697   \{}
\DoxyCodeLine{698     Serial.println(\textcolor{stringliteral}{"{}Will message set\(\backslash\)n"{}});}
\DoxyCodeLine{699     result = 1;}
\DoxyCodeLine{700   \}}
\DoxyCodeLine{701   \textcolor{keywordflow}{else}}
\DoxyCodeLine{702   \{}
\DoxyCodeLine{703     Serial.println(\textcolor{stringliteral}{"{}Will message not set\(\backslash\)n"{}});}
\DoxyCodeLine{704   \}}
\DoxyCodeLine{705   free(command);}
\DoxyCodeLine{706   \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{707 \}}
\DoxyCodeLine{708 }
\DoxyCodeLine{715 \textcolor{keywordtype}{int} \mbox{\hyperlink{_n_b___r410_m_8h_ac0f44c06684338d6571b119289066fce}{setMQTT}}(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *host, \textcolor{keywordtype}{int} port)}
\DoxyCodeLine{716 \{}
\DoxyCodeLine{717   \textcolor{keywordtype}{int} result = 0;}
\DoxyCodeLine{718   \textcolor{keywordtype}{char} *command = NULL;}
\DoxyCodeLine{719   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} SARA\_IP\_CONNECT\_TIMEOUT = 10000;}
\DoxyCodeLine{720 }
\DoxyCodeLine{721   command = (\textcolor{keywordtype}{char} *)malloc(\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{char}) * (strlen(SARA\_CONNECT\_MQTT) + strlen(host) + 15));}
\DoxyCodeLine{722   \textcolor{keywordflow}{if} (command == NULL)}
\DoxyCodeLine{723   \{}
\DoxyCodeLine{724     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Malloc failed\(\backslash\)n"{}});}
\DoxyCodeLine{725     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{726   \}}
\DoxyCodeLine{727   \textcolor{comment}{// Create the command}}
\DoxyCodeLine{728   sprintf(command, \textcolor{stringliteral}{"{}AT\%s=\%d,\(\backslash\)"{}\%s\(\backslash\)"{},\%d"{}}, SARA\_CONNECT\_MQTT, 2, host, port);}
\DoxyCodeLine{729   \textcolor{comment}{// Send the command}}
\DoxyCodeLine{730   \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}Setting MQTT hostname \& port\(\backslash\)n"{}});}
\DoxyCodeLine{731 }
\DoxyCodeLine{732   \textcolor{comment}{// Empties buffer and transmits the command}}
\DoxyCodeLine{733   \mbox{\hyperlink{_n_b___r410_m_8h_a301d0294e9c5137ccbc922d3bf7831aa}{transmitCommand}}(command);}
\DoxyCodeLine{734 }
\DoxyCodeLine{735   \textcolor{comment}{// Wait for the response}}
\DoxyCodeLine{736   \textcolor{keywordflow}{if} (\mbox{\hyperlink{_n_b___r410_m_8h_a2540498d294eca76534a8015310df26d}{getResponse}}(SARA\_RESPONSE\_OK, SARA\_IP\_CONNECT\_TIMEOUT))}
\DoxyCodeLine{737   \{}
\DoxyCodeLine{738     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}MQTT hostname \& port set\(\backslash\)n"{}});}
\DoxyCodeLine{739     result = 1;}
\DoxyCodeLine{740   \}}
\DoxyCodeLine{741   \textcolor{keywordflow}{else}}
\DoxyCodeLine{742   \{}
\DoxyCodeLine{743     \mbox{\hyperlink{_n_b___r410_m_8h_a46a4e6cfc8eae8ca667e05b6b55f97c1}{printToConsole}}(\textcolor{stringliteral}{"{}MQTT hostname \& port not set\(\backslash\)n"{}});}
\DoxyCodeLine{744   \}}
\DoxyCodeLine{745 }
\DoxyCodeLine{746   free(command);}
\DoxyCodeLine{747   \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{748 \}}

\end{DoxyCode}
